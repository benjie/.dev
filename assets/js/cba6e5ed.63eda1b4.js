"use strict";(self.webpackChunk_localrepo_benjie_dev=self.webpackChunk_localrepo_benjie_dev||[]).push([[593],{1824:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var i=n(5893),a=n(1151);const l={identifier:"1058",title:"List coercion algorithm",stage:"1",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/1058",events:[{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2024/12-Dec/05-wg-primary.md",date:new Date("2024-12-05T00:00:00.000Z"),actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2024/2024-12.md",date:"2024-12",actor:null},{type:"commitsPushed",date:new Date("2024-11-28T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/fba35d54523692c5b112c8fc3c773f50ef402b43",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/fba35d54523692c5b112c8fc3c773f50ef402b43",headline:"Fix bug in null handling",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",date:new Date("2023-12-07T00:00:00.000Z"),actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",date:"2023-12",actor:null},{type:"commitsPushed",date:new Date("2023-11-13T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/6aed5a9653a92ada8849fdf6e289623997977436",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/6aed5a9653a92ada8849fdf6e289623997977436",headline:"Add another example",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"prCreated",date:new Date("2023-11-09T17:40:17.000Z"),href:"https://github.com/graphql/graphql-spec/pull/1058",actor:"benjie"},{type:"commitsPushed",date:new Date("2023-11-09T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/b21bb996796b487d7f369f7e162a0d3096ffaae4",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/b21bb996796b487d7f369f7e162a0d3096ffaae4",headline:"Add note about nullable variables with default values",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/a91cdba0dfedd0c13655f03cc3ac3910da388686",headline:"Add variables to table",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/4ca2023992ed5bb2aef2c58d4f532859fb580acd",headline:"Algorithm for coercing list values",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/ec3d50a664f02a3218c81bb8c3202c91765fa952",headline:"Move note and clarify algorithm",ghUser:"benjie",authorName:"Benjie Gillam"}]}],related:"1002",shortname:"List coercion algorithm",image:"/img/rfc_tracker.png"},r=void 0,s={id:"1058",title:"List coercion algorithm",description:"At a glance",source:"@site/rfcs/1058.md",sourceDirName:".",slug:"/1058",permalink:"/rfcs/1058",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{identifier:"1058",title:"List coercion algorithm",stage:"1",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/1058",events:[{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2024/12-Dec/05-wg-primary.md",date:"2024-12-05T00:00:00.000Z",actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2024/2024-12.md",date:"2024-12",actor:null},{type:"commitsPushed",date:"2024-11-28T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/fba35d54523692c5b112c8fc3c773f50ef402b43",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/fba35d54523692c5b112c8fc3c773f50ef402b43",headline:"Fix bug in null handling",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",date:"2023-12-07T00:00:00.000Z",actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",date:"2023-12",actor:null},{type:"commitsPushed",date:"2023-11-13T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/6aed5a9653a92ada8849fdf6e289623997977436",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/6aed5a9653a92ada8849fdf6e289623997977436",headline:"Add another example",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"prCreated",date:"2023-11-09T17:40:17.000Z",href:"https://github.com/graphql/graphql-spec/pull/1058",actor:"benjie"},{type:"commitsPushed",date:"2023-11-09T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/b21bb996796b487d7f369f7e162a0d3096ffaae4",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/b21bb996796b487d7f369f7e162a0d3096ffaae4",headline:"Add note about nullable variables with default values",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/a91cdba0dfedd0c13655f03cc3ac3910da388686",headline:"Add variables to table",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/4ca2023992ed5bb2aef2c58d4f532859fb580acd",headline:"Algorithm for coercing list values",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/ec3d50a664f02a3218c81bb8c3202c91765fa952",headline:"Move note and clarify algorithm",ghUser:"benjie",authorName:"Benjie Gillam"}]}],related:"1002",shortname:"List coercion algorithm",image:"/img/rfc_tracker.png"},sidebar:"rfcsSidebar",previous:{title:"Fix CoerceArgumentValues() hasValue",permalink:"/rfcs/1056"},next:{title:"Expand @deprecated to Objects",permalink:"/rfcs/997"}},h={},c=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Timeline",id:"timeline",level:2},{value:"Time to visit list coercion",id:"time-to-visit-list-coercion",level:2}];function o(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Identifier"}),": #1058"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Stage"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-1-proposal",children:"RFC1: Proposal"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Champion"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"PR"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/pull/1058",children:"List coercion algorithm"})]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"timeline",children:"Timeline"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsxs)(t.strong,{children:["Added to ",(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2024/12-Dec/05-wg-primary.md",children:"2024-12-05 WG agenda"})]})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsxs)(t.strong,{children:["Mentioned in ",(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/notes/2024/2024-12.md",children:"2024-12 WG notes"})]})}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Commit pushed"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/fba35d54523692c5b112c8fc3c773f50ef402b43",children:"Fix bug in null handling"})," on 2024-11-28 by ",(0,i.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsxs)(t.strong,{children:["Added to ",(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",children:"2023-12-07 WG agenda"})]})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsxs)(t.strong,{children:["Mentioned in ",(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",children:"2023-12 WG notes"})]})}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Commit pushed"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/6aed5a9653a92ada8849fdf6e289623997977436",children:"Add another example"})," on 2023-11-13 by ",(0,i.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsxs)(t.strong,{children:[(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/pull/1058",children:"Spec PR"})," created"]})," on 2023-11-09 by benjie"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"4 commits pushed"})," on 2023-11-09:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/b21bb996796b487d7f369f7e162a0d3096ffaae4",children:"Add note about nullable variables with default values"})," by ",(0,i.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/a91cdba0dfedd0c13655f03cc3ac3910da388686",children:"Add variables to table"})," by ",(0,i.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/4ca2023992ed5bb2aef2c58d4f532859fb580acd",children:"Algorithm for coercing list values"})," by ",(0,i.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/ec3d50a664f02a3218c81bb8c3202c91765fa952",children:"Move note and clarify algorithm"})," by ",(0,i.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"Fixes #1002."}),"\n",(0,i.jsx)(t.p,{children:"Previously, list coercion does not detail what to do with variables at all, and that could lead to either a null pointer exception, or to double-coercion of the variable value if you're only following the spec."}),"\n",(0,i.jsx)(t.p,{children:"Consider the following valid schema:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",children:"type Query {\n  sum(numbers:[Int!]!): Int\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"and the query that is valid against this schema:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",children:"query Q ($number: Int = 3) {\n  sum(numbers: [1, $number, 3])\n}\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"NOTE"}),": We're using the variable in a list item position!"]}),"\n",(0,i.jsxs)(t.p,{children:["If you issue this to the GraphQL server with variables ",(0,i.jsx)(t.code,{children:'{"number": null}'})," then ",(0,i.jsx)(t.code,{children:"CoerceVariableValues"})," will give you ",(0,i.jsx)(t.code,{children:'{"number": null}'})," and when you fast-forward to ",(0,i.jsx)(t.code,{children:"CoerceArgumentValues"})," you'll go in to 5.j.iii.1:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://spec.graphql.org/draft/#sel-NANTHHCJFTDFBBCAACGB0yS",children:"https://spec.graphql.org/draft/#sel-NANTHHCJFTDFBBCAACGB0yS"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Let {coercedValues} be an empty unordered Map. ",(0,i.jsx)(t.code,{children:"coercedValues = {}"})]}),"\n",(0,i.jsxs)(t.li,{children:["Let {argumentValues} be the argument values provided in {field}. ",(0,i.jsx)(t.code,{children:"argumentValues = { numbers: [1, $number, 3] }"})]}),"\n",(0,i.jsxs)(t.li,{children:["Let {fieldName} be the name of {field}. ",(0,i.jsx)(t.code,{children:"fieldName = 'sum'"})]}),"\n",(0,i.jsxs)(t.li,{children:["Let {argumentDefinitions} be the arguments defined by {objectType} for the\nfield named {fieldName}. ",(0,i.jsx)(t.code,{children:"argumentDefinitions = { numbers: ... }"})]}),"\n",(0,i.jsxs)(t.li,{children:["For each {argumentDefinition} in {argumentDefinitions}:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Let {argumentName} be the name of {argumentDefinition}. ",(0,i.jsx)(t.code,{children:"argumentName = 'numbers'"})]}),"\n",(0,i.jsxs)(t.li,{children:["Let {argumentType} be the expected type of {argumentDefinition}. ",(0,i.jsx)(t.code,{children:"argumentType = [Int!]!"})]}),"\n",(0,i.jsxs)(t.li,{children:["Let {defaultValue} be the default value for {argumentDefinition}. ",(0,i.jsx)(t.code,{children:"defaultValue = undefined"})]}),"\n",(0,i.jsxs)(t.li,{children:["Let {hasValue} be {true} if {argumentValues} provides a value for the name\n{argumentName}. ",(0,i.jsx)(t.code,{children:"hasValue = true"})]}),"\n",(0,i.jsxs)(t.li,{children:["Let {argumentValue} be the value provided in {argumentValues} for the name\n{argumentName}. ",(0,i.jsx)(t.code,{children:"argumentValue = [1, $number, 3]"})]}),"\n",(0,i.jsxs)(t.li,{children:["If {argumentValue} is a {Variable}: ",(0,i.jsx)(t.code,{children:"NOPE"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Let {variableName} be the name of {argumentValue}."}),"\n",(0,i.jsx)(t.li,{children:"Let {hasValue} be {true} if {variableValues} provides a value for the name\n{variableName}."}),"\n",(0,i.jsx)(t.li,{children:"Let {value} be the value provided in {variableValues} for the name\n{variableName}."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Otherwise, let\u200b {value} be {argumentValue}. ",(0,i.jsx)(t.code,{children:"value = [1, $number, 3]"})]}),"\n",(0,i.jsxs)(t.li,{children:["If {hasValue} is not {true} and {defaultValue} exists (including {null}):  ",(0,i.jsx)(t.code,{children:"NOT TRIGGERED"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Add an entry to {coercedValues} named {argumentName} with the value\n{defaultValue}."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Otherwise if {argumentType} is a Non-Nullable type, and either {hasValue} is\nnot {true} or {value} is {null}, raise a ",(0,i.jsx)(t.em,{children:"field error"}),".  ",(0,i.jsx)(t.code,{children:"NOT TRIGGERED"})]}),"\n",(0,i.jsxs)(t.li,{children:["Otherwise if {hasValue} is true: ",(0,i.jsx)(t.code,{children:"Yes, it is"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["If {value} is {null}: ",(0,i.jsx)(t.code,{children:"It is not, it is a list"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Add an entry to {coercedValues} named {argumentName} with the value\n{null}."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Otherwise, if {argumentValue} is a {Variable}: ",(0,i.jsx)(t.code,{children:"It is not, it is a list"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Add an entry to {coercedValues} named {argumentName} with the value\n{value}."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Otherwise: ",(0,i.jsx)(t.code,{children:"YES"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["If {value} cannot be coerced according to the input coercion rules of\n{argumentType}, raise a ",(0,i.jsx)(t.em,{children:"field error"}),". ",(0,i.jsx)(t.strong,{children:"TIME TO VISIT LIST COERCION"})]}),"\n",(0,i.jsx)(t.li,{children:"Let {coercedValue} be the result of coercing {value} according to the\ninput coercion rules of {argumentType}."}),"\n",(0,i.jsx)(t.li,{children:"Add an entry to {coercedValues} named {argumentName} with the value\n{coercedValue}."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.li,{children:"Return {coercedValues}."}),"\n"]}),"\n",(0,i.jsxs)(t.h2,{id:"time-to-visit-list-coercion",children:["Time to visit ",(0,i.jsx)(t.a,{href:"https://spec.graphql.org/draft/#sec-List",children:"list coercion"})]}),"\n",(0,i.jsxs)(t.p,{children:["We need to coerce the value ",(0,i.jsx)(t.code,{children:"[1, $number, 3]"})," to the non-nullable type ",(0,i.jsx)(t.code,{children:"[Int!]!"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"Step 1: handle the non-null. It's not null. Great!"}),"\n",(0,i.jsxs)(t.p,{children:["Now we need to coerce the value ",(0,i.jsx)(t.code,{children:"[1, $number, 3]"})," to the list type ",(0,i.jsx)(t.code,{children:"[Int!]"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"Here's what the spec says about input coercion for lists:"}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"When expected as an input, list values are accepted only when each item in the list can be accepted by the list\u2019s item type."})}),"\n",(0,i.jsx)(t.p,{children:"If the value passed as an input to a list type is not a list and not the null value, then the result of input coercion is a list of size one, where the single item value is the result of input coercion for the list\u2019s item type on the provided value (note this may apply recursively for nested lists)."}),"\n",(0,i.jsx)(t.p,{children:"This allows inputs which accept one or many arguments (sometimes referred to as \u201cvar\u200b args\u201d) to declare their input type as a list while for the common case of a single value, a client can just pass that value directly rather than constructing the list."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"We have a list, so we only care about the bold line."}),"\n",(0,i.jsx)(t.p,{children:"This line seems to miss a bunch of situations."}),"\n",(0,i.jsxs)(t.p,{children:["For example: if we were coercing to ",(0,i.jsx)(t.code,{children:"[Int]"})," the value ",(0,i.jsx)(t.code,{children:"[1, $number, 3]"})," with variables ",(0,i.jsx)(t.code,{children:"{}"})," then ",(0,i.jsx)(t.em,{children:"is"})," $number (which is undefined, since it wasn't provided in the variables) \"accepted by the list's item type\"? Really we must coerce this to ",(0,i.jsx)(t.code,{children:"null"}),", but that doesn't seem to be detailed. In fact this entire section doesn't mention variables at all."]}),"\n",(0,i.jsxs)(t.p,{children:["We're actually coercing to ",(0,i.jsx)(t.code,{children:"[Int!]"}),", so the question is: is ",(0,i.jsx)(t.code,{children:"$number"})," accepted by the list's item type? ",(0,i.jsx)(t.code,{children:"$number"})," itself is a variable, so..."]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.p,{children:"I've attempted to solve this problem by being much more explicit about the input coercion for lists, inspired by the input coercion for input objects. I've also added a non-normative note highlighting the risk of a null variable being fed through into a non-nullable position, why that can occur (validation) and what we do about it (field error). I've also expanded the table with both variables and many more examples to cover many more edge cases."}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>s,a:()=>r});var i=n(7294);const a={},l=i.createContext(a);function r(e){const t=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(l.Provider,{value:t},e.children)}}}]);
"use strict";(self.webpackChunk_localrepo_benjie_dev=self.webpackChunk_localrepo_benjie_dev||[]).push([[4878],{704:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var r=i(5893),s=i(1151);const t={identifier:"MatchesDirective",stage:"0",title:"Matches Directive",events:[{type:"docCreated",date:new Date("2025-09-19T10:31:31.000Z"),href:"https://github.com/graphql/graphql-wg/blob/1f6dce664b79bb6fce63e9b4132df653f0ed0285/rfcs/MatchesDirective.md",actor:"Mark Larah"}],shortname:"Matches Directive",image:"/img/rfc_tracker.png"},o=void 0,a={id:"MatchesDirective",title:"Matches Directive",description:"At a glance",source:"@site/rfcs/MatchesDirective.md",sourceDirName:".",slug:"/MatchesDirective",permalink:"/rfcs/MatchesDirective",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{identifier:"MatchesDirective",stage:"0",title:"Matches Directive",events:[{type:"docCreated",date:"2025-09-19T10:31:31.000Z",href:"https://github.com/graphql/graphql-wg/blob/1f6dce664b79bb6fce63e9b4132df653f0ed0285/rfcs/MatchesDirective.md",actor:"Mark Larah"}],shortname:"Matches Directive",image:"/img/rfc_tracker.png"},sidebar:"rfcsSidebar",previous:{title:"Field Extensions",permalink:"/rfcs/FieldExtensions"},next:{title:'Fix "response position" definition; clarify sibling errors on propagation',permalink:"/rfcs/1183"}},l={},d=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Timeline",id:"timeline",level:2},{value:"\ud83d\udcdc Problem Statement",id:"-problem-statement",level:2},{value:"Current Solutions",id:"current-solutions",level:2},{value:"1. <code>supports</code> argument",id:"1-supports-argument",level:3},{value:"1.a. With enums",id:"1a-with-enums",level:4},{value:"1.b. With strings",id:"1b-with-strings",level:4},{value:"1.c. Compiled",id:"1c-compiled",level:4},{value:"2. Server-side mapping",id:"2-server-side-mapping",level:3},{value:"3. Runtime AST inspection",id:"3-runtime-ast-inspection",level:3},{value:"3.b. Add the <code>supports</code> argument at runtime",id:"3b-add-the-supports-argument-at-runtime",level:4},{value:"\ud83e\uddd1\u200d\ud83d\udcbb Proposed Solution",id:"-proposed-solution",level:2},{value:"Example",id:"example",level:4},{value:"<code>sort</code> argument",id:"sort-argument",level:3},{value:"<code>path</code> argument",id:"path-argument",level:3},{value:"<code>repeatable</code>",id:"repeatable",level:3},{value:"Validation",id:"validation",level:3},{value:"Request Validation",id:"request-validation",level:4},{value:"Response Validation",id:"response-validation",level:4},{value:"Appendix",id:"appendix",level:2},{value:"Controlling if ordering matters",id:"controlling-if-ordering-matters",level:3},{value:"Alternative names",id:"alternative-names",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Identifier"}),": MatchesDirective"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stage"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-0-strawman",children:"RFC0: Strawman"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Champion"}),": -"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PR"}),": -"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"timeline",children:"Timeline"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"https://github.com/graphql/graphql-wg/blob/1f6dce664b79bb6fce63e9b4132df653f0ed0285/rfcs/MatchesDirective.md",children:"RFC document created"})})," on 2025-09-19 by Mark Larah"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.h1,{id:"rfc-matches-directive",children:"RFC: Matches Directive"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Proposed by:"})," ",(0,r.jsx)(n.a,{href:"https://twitter.com/mark_larah",children:"Mark Larah"})," - Yelp"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Implementation PR"}),": todo"]}),"\n",(0,r.jsxs)(n.p,{children:["This RFC proposes adding a new directive ",(0,r.jsx)(n.code,{children:"@matches"}),' and associated validation\nrules to enforce the safe selection of "supported" types when using fragment\nspreads on a field that returns an array of unions of polymorphic types:']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'directive @matches(\n  """\n  Optional dotted field path (relative to the field\u2019s return value) that\n  identifies where the polymorphic element(s) appear.\n  """\n  path: String,\n\n  """\n  Whether or not argument ordering is enforced. This may be set to False if the\n  order is meaingful and used by the application logic.\n  """\n  sort: Boolean = True\n) repeatable on ARGUMENT_DEFINITION\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-problem-statement",children:"\ud83d\udcdc Problem Statement"}),"\n",(0,r.jsx)(n.p,{children:"We need to be able to communicate to the server what possible return types are\nsupported in an array of unions or interfaces."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.p,{children:"A client application may wish to display a fixed number of media items:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query GetMedia {\n  getMedia { # returns a fixed array of `Book | Movie`\n    ... on Book { title author }\n    ... on Movie { title director }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["...but when we introduce the new media type ",(0,r.jsx)(n.code,{children:"Opera"})," into the union, an old\nclient using the above query will not be able to display any returned results\nfor ",(0,r.jsx)(n.code,{children:"Opera"}),', leaving empty "slots" in the UI.']}),"\n",(0,r.jsx)(n.h2,{id:"current-solutions",children:"Current Solutions"}),"\n",(0,r.jsx)(n.p,{children:"A number of alternative approaches exist:"}),"\n",(0,r.jsxs)(n.h3,{id:"1-supports-argument",children:["1. ",(0,r.jsx)(n.code,{children:"supports"})," argument"]}),"\n",(0,r.jsxs)(n.p,{children:["We could manually introduce an argument (",(0,r.jsx)(n.code,{children:"only"}),", ",(0,r.jsx)(n.code,{children:"supports"}),", etc) to the field\nto communicate which types are supported:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query GetMedia {\n  getMedia(supports: [Book, Movie]) {\n    ... on Book { title author }\n    ... on Movie { title director }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The resolver must then read the ",(0,r.jsx)(n.code,{children:"supports"})," field argument to filter and only\nreturn compatible types."]}),"\n",(0,r.jsx)(n.h4,{id:"1a-with-enums",children:"1.a. With enums"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example SDL"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"union Media = Book | Movie | Symphony\n\nenum MediaFilter {\n  Book\n  Movie\n  Symphony\n}\n\ntype Query {\n  getMedia(supported: [MediaFilter!]!): [Media]\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udc4e Downsides"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Requires humans to manually create a mirror enum of the union"}),"\n",(0,r.jsxs)(n.li,{children:["Does not guarantee that the ",(0,r.jsx)(n.code,{children:"supports"})," argument is respected at runtime"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"1b-with-strings",children:"1.b. With strings"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example SDL"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"union Media = Book | Movie | Symphony\n\ntype Query {\n  getMedia(supported: [String!]!): [Media]\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udc4e Downsides"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Strings are more error prone - e.g. humans may get the capitalization wrong"}),"\n",(0,r.jsxs)(n.li,{children:["Does not guarantee that the ",(0,r.jsx)(n.code,{children:"supports"})," argument is respected at runtime"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"1c-compiled",children:"1.c. Compiled"}),"\n",(0,r.jsxs)(n.p,{children:["Relay provides a ",(0,r.jsx)(n.code,{children:"@match"})," directive:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://relay.dev/docs/guides/data-driven-dependencies/server-3d/#match-design-principles",children:"https://relay.dev/docs/guides/data-driven-dependencies/server-3d/#match-design-principles"})}),"\n",(0,r.jsx)(n.p,{children:"Queries are compiled, such that this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query GetMedia {\n  getMedia {\n    ... on Book { title author }\n    ... on Movie { title director }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"...becomes this (at build time):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query GetMedia {\n  getMedia(supports: ["Book", "Movie"]) {\n    ... on Book { title author }\n    ... on Movie { title director }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This improves on both ",(0,r.jsx)(n.code,{children:"1.a."})," and ",(0,r.jsx)(n.code,{children:"1.b"}),":"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udc4d Upsides"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"There's no extra enum to maintain"}),"\n",(0,r.jsx)(n.li,{children:"Avoid humans passing freeform strings"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udc4e Downsides"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Requires a compiler step. Non compiling clients cannot support this (see #3\nbelow for why)"}),"\n",(0,r.jsxs)(n.li,{children:["Does not guarantee that the ",(0,r.jsx)(n.code,{children:"supports"})," argument is respected at runtime"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-server-side-mapping",children:"2. Server-side mapping"}),"\n",(0,r.jsxs)(n.p,{children:["Let's assume that clients send a header on every request to identify their\nversion e.g. (",(0,r.jsx)(n.code,{children:"v1"}),", ",(0,r.jsx)(n.code,{children:"v2"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"We could maintain a mapping on the server that encodes the knowledge of which\nclient supports the rendering of which types:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "v1": ["Book", "Movie"],\n  "v2": ["Book", "Movie", "Opera"],\n  "v3": ["Book", "Movie", "Opera", "Audiobook"],\n  ...\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"The resolver checks this mapping to filter what types to return."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udc4e Downsides"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Extra source of truth / moving part / thing to maintain"}),"\n",(0,r.jsx)(n.li,{children:"Stores freeform strings - no validation that the typenames are valid"}),"\n",(0,r.jsx)(n.li,{children:"Does not guarantee that this is respected at runtime"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-runtime-ast-inspection",children:"3. Runtime AST inspection"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"[!WARNING]\nThis example is not actually safe, do not use."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"In theory, the names of the fragments in the selection set is available in the\nAST of the query passed to resolvers at runtime. A resolver could attempt\nsomething like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const resolvers = {\n  Query: {\n    getMedia: (_, __, ___, info) => {\n      // ignore https://github.com/graphql/graphql-js/issues/605\n      const node = info.fieldNodes[0];\n\n      // gets something like ["Book", "Movie"]\n      const supportedTypes = node.selectionSet.selections.map(\n        ({ typeCondition }) => typeCondition.name.value\n      );\n'})}),"\n",(0,r.jsx)(n.p,{children:"However, this would cause (many) issues at runtime."}),"\n",(0,r.jsx)(n.p,{children:"One such problem: if a client writes this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query GetMedia {\n  ...BooksTab\n  ...MoviesTab\n}\n\nfragment BooksTab on Query {\n  getMedia {\n    ... on Book { title author }\n  }\n}\n\nfragment MoviesTab on Query {\n  getMedia {\n    ... on Movie { title director }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The selection sets in fragments get merged, and the ",(0,r.jsx)(n.code,{children:"getMedia"})," resolver is only\nexecuted once. With the above implementation, we'd ",(0,r.jsx)(n.em,{children:"only"})," return Books (the\nfirst to be evaluated). Since the resolver is only executed once, this is\nimpossible to implement correctly."]}),"\n",(0,r.jsxs)(n.h4,{id:"3b-add-the-supports-argument-at-runtime",children:["3.b. Add the ",(0,r.jsx)(n.code,{children:"supports"})," argument at runtime"]}),"\n",(0,r.jsxs)(n.p,{children:["We could use this approach to instead add the ",(0,r.jsx)(n.code,{children:"supports"})," argument at runtime\n(similar to 1.c.)."]}),"\n",(0,r.jsx)(n.p,{children:'By default however, this would cause type checking on the client to fail (since\nthe "required" argument isn\'t provided).'}),"\n",(0,r.jsx)(n.p,{children:"In addition, noramlized cache layers wouldn't be aware of this runtime\ntransform."}),"\n",(0,r.jsx)(n.p,{children:"If a client issues this query:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query GetMedia {\n  getMedia {\n    ... on Book { title author }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"...and later on, this query:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query GetMedia {\n  getMedia {\n    ... on Movie { title author }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Oops! That's a cache hit! And overriding the cache policy to fetch anyway would\noverwrite the previous cache value for ",(0,r.jsx)(n.code,{children:"Query.getMedia"}),", causing the previously\nrendered UI to have empty slots."]}),"\n",(0,r.jsx)(n.h2,{id:"-proposed-solution",children:"\ud83e\uddd1\u200d\ud83d\udcbb Proposed Solution"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"@matches"})," directive can be applied to a field argument when returning an\narray of unions of polymorphic types. It declares the set of valid response\ntypes, and is enforced by the server."]}),"\n",(0,r.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"SDL"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"directive @matches(sorted: Boolean = True) on ARGUMENT_DEFINITION\n\nunion Media = Book | Movie | Opera\n\ntype Query {\n  getMedia(supports: [String!] @matches): [Media]\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Query"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query GetMedia {\n  getMedia(supports: ["Book", "Movie"]) {\n    ... on Book { title author }\n    ... on Movie { title director }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"sort-argument",children:[(0,r.jsx)(n.code,{children:"sort"})," argument"]}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"sort"})," is true (default), the argument\u2019s values are required to appear in\nsorted (alphabetical) order:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'getMedia(supports: ["Book", "Movie"]) # OK'})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'getMedia(supports: ["Movie", "Book"]) # \u274c Error: not sorted'})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This is desirable as a default behaviour. If not enforced, this would imply\ncache denormalization and cache misses in clients."}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"sort"})," is false, this is not enforced, and both examples above are allowed.\nThis may be desirable if the application logic depends on the ordering of the\nargument values - e.g. to signal a desired priority or ordering of result types."]}),"\n",(0,r.jsxs)(n.h3,{id:"path-argument",children:[(0,r.jsx)(n.code,{children:"path"})," argument"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"path"})," is an optional argument that accepts a dot-seperated\n",(0,r.jsx)(n.a,{href:"https://spec.graphql.org/September2025/#sec-Response-Position",children:"response path"})," relative to the field."]}),"\n",(0,r.jsx)(n.p,{children:"This is primarily in order to support nested responses inside connection objects\nwhen using pagination:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'type Query {\n  getPaginatedMedia(\n    first: Int\n    after: String\n    only: [String!] @matches(path: "nodes")\n  ): MediaConnection\n}\n\ntype MediaConnection {\n  nodes: [Media!]\n  pageInfo: PageInfo\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"repeatable",children:(0,r.jsx)(n.code,{children:"repeatable"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@matches"})," may be applied multiple times in order to support multiple nested\nfields:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'type Query {\n  getMedia(\n    first: Int\n    after: String\n    only: [String!] @matches(path: "nodes") @matches(path: "all")\n  ): MediaConnection\n}\n\ntype MediaConnection {\n  nodes: [Media!]\n  pageInfo: PageInfo\n\n  """Clients may use this if they don\'t want to use pagination."""\n  all: [Media!]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"validation",children:"Validation"}),"\n",(0,r.jsx)(n.p,{children:"The following new validation rules are applied:"}),"\n",(0,r.jsx)(n.h4,{id:"request-validation",children:"Request Validation"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["All selected types must match an entry in ",(0,r.jsx)(n.code,{children:"supports"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  getMedia(supports: ["Book"]) {\n    ... on Book { title author }\n    ... on Movie { title director } # \u274c Error: `supports` did not specify `Movie`.\n  }\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"All specified type names must be valid return types:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  getMedia(supports: ["VideoGame"]) { # \u274c Error: `Media` union does not contain `VideoGame`\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"response-validation",children:"Response Validation"}),"\n",(0,r.jsxs)(n.p,{children:["Throw an error if the resolver returns a type that is not present in the\n",(0,r.jsx)(n.code,{children:"supports"})," array:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const resolvers = {\n  Query: {\n    getMedia: (_, { supports }) => {\n      // supports = ['Book', 'Movie']\n\n      // \u274c Error: `supports` did not specify `Opera`.\n      return [{ __typename: 'Opera', title: 'La Boheme'}]\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,r.jsx)(n.h3,{id:"controlling-if-ordering-matters",children:"Controlling if ordering matters"}),"\n",(0,r.jsx)(n.p,{children:"There is a meaningful difference between these two queries:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query PrefersBooks {\n  getMedia(supports: ["Book", "Movie"]) {\n    ... on Book { title author }\n    ... on Movie { title director }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query PrefersMovies {\n  getMedia(supports: ["Movie", "Book"]) {\n    ... on Book { title author }\n    ... on Movie { title director }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["A client may rely on the ordering of ",(0,r.jsx)(n.code,{children:"supports"})," fields to indicate the\npreference and rank order in which to return objects."]}),"\n",(0,r.jsx)(n.p,{children:"However, this may cause confusion and unintentional cache misses."}),"\n",(0,r.jsxs)(n.p,{children:["The client must decide if they wish to make the ordering of ",(0,r.jsx)(n.code,{children:"supports"}),"\nmeaningful or not - and it not, we should enforce that the ordering is\nconsistent (alphabetically sorted)."]}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.code,{children:"sort"})," argument is provided to support this:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"sorted"})," is True (default), ",(0,r.jsx)(n.code,{children:"supports"})," argument ordering is enforced via a\nrequest validation rule."]}),"\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"sorted"})," is False, ",(0,r.jsx)(n.code,{children:"supports"})," argument ordering is not enforced, allowing\ndifferent fragments to specify different orderings (and be cached\nindependently)."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"type Query {\n  # different parts of the app want different media items with different ordering - we're ok with this field being cached multiple times \n  getMedia(supports: [String!] @matches(sorted: False)): [Media]\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"alternative-names",children:"Alternative names"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@matches"})," is proposed in order to avoid conflicting with Relay's ",(0,r.jsx)(n.code,{children:"@match"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Also considered:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@filter"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@filterTypes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@matchFragments"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@matchTypes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@only"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@supports"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@supportsTypes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@typeFilter"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>a,a:()=>o});var r=i(7294);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunk_localrepo_benjie_dev=self.webpackChunk_localrepo_benjie_dev||[]).push([[474],{8404:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>h});var t=n(5893),i=n(1151);const a={identifier:"1153",closedAt:null,mergedAt:null,title:"Allow clients to disable error propagation via request parameter",stage:"1",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/1153",events:[{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/04-Apr/03-wg-primary.md",date:new Date("2025-04-03T00:00:00.000Z"),actor:null},{type:"prCreated",date:new Date("2025-03-27T14:19:33.000Z"),href:"https://github.com/graphql/graphql-spec/pull/1153",actor:"benjie"},{type:"commitsPushed",date:new Date("2025-03-27T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/920983277da43cb0df8d4db00546dbabbd03acbc",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/920983277da43cb0df8d4db00546dbabbd03acbc",headline:"Add error behaviors to the spec",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/9fee169010ef6a49774db656b9715c7e714a63e3",headline:"Any execution may include onError",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/bd04f99a1e1c0aa2d906a30d6cb267b3aecff983",headline:"Clearer wording, fix spelling",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/5f67e8d08ec40d118cc9af506d576a05fbfc92d6",headline:"Minor edits",ghUser:"benjie",authorName:"Benjie Gillam"}]}],related:"1065",shortname:"Allow clients to disable error propagation via request parameter",image:"/img/rfc_tracker.png"},s=void 0,l={id:"1153",title:"Allow clients to disable error propagation via request parameter",description:"At a glance",source:"@site/rfcs/1153.md",sourceDirName:".",slug:"/1153",permalink:"/rfcs/1153",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{identifier:"1153",closedAt:null,mergedAt:null,title:"Allow clients to disable error propagation via request parameter",stage:"1",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/1153",events:[{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/04-Apr/03-wg-primary.md",date:"2025-04-03T00:00:00.000Z",actor:null},{type:"prCreated",date:"2025-03-27T14:19:33.000Z",href:"https://github.com/graphql/graphql-spec/pull/1153",actor:"benjie"},{type:"commitsPushed",date:"2025-03-27T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/920983277da43cb0df8d4db00546dbabbd03acbc",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/920983277da43cb0df8d4db00546dbabbd03acbc",headline:"Add error behaviors to the spec",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/9fee169010ef6a49774db656b9715c7e714a63e3",headline:"Any execution may include onError",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/bd04f99a1e1c0aa2d906a30d6cb267b3aecff983",headline:"Clearer wording, fix spelling",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/5f67e8d08ec40d118cc9af506d576a05fbfc92d6",headline:"Minor edits",ghUser:"benjie",authorName:"Benjie Gillam"}]}],related:"1065",shortname:"Allow clients to disable error propagation via request parameter",image:"/img/rfc_tracker.png"},sidebar:"rfcsSidebar",previous:{title:"Add validation rule that operation types exist",permalink:"/rfcs/955"},next:{title:"List coercion algorithm",permalink:"/rfcs/1058"}},o={},h=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Timeline",id:"timeline",level:2}];function c(e){const r={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Identifier"}),": #1153"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Stage"}),": ",(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-1-proposal",children:"RFC1: Proposal"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Champion"}),": ",(0,t.jsx)(r.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"PR"}),": ",(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-spec/pull/1153",children:"Allow clients to disable error propagation via request parameter"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Related"}),":","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"/rfcs/1065",title:"SemanticNonNull type (null only on error) / RFC0",children:"#1065"})," (SemanticNonNull type (null only on error))"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"timeline",children:"Timeline"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsxs)(r.strong,{children:["Added to ",(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/04-Apr/03-wg-primary.md",children:"2025-04-03 WG agenda"})]})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsxs)(r.strong,{children:[(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-spec/pull/1153",children:"Spec PR"})," created"]})," on 2025-03-27 by benjie"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"4 commits pushed"})," on 2025-03-27:","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-spec/commit/920983277da43cb0df8d4db00546dbabbd03acbc",children:"Add error behaviors to the spec"})," by ",(0,t.jsx)(r.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-spec/commit/9fee169010ef6a49774db656b9715c7e714a63e3",children:"Any execution may include onError"})," by ",(0,t.jsx)(r.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-spec/commit/bd04f99a1e1c0aa2d906a30d6cb267b3aecff983",children:"Clearer wording, fix spelling"})," by ",(0,t.jsx)(r.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-spec/commit/5f67e8d08ec40d118cc9af506d576a05fbfc92d6",children:"Minor edits"})," by ",(0,t.jsx)(r.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"Replaces:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"#1050"}),"\n",(0,t.jsx)(r.li,{children:"#1145"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"Requires editorial to be merged first:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"#1152"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"GraphQL.js implementation:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-js/pull/4364",children:"https://github.com/graphql/graphql-js/pull/4364"})}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.a,{href:"https://www.youtube.com/shorts/gYnVaZz-19A",children:"Please see this 60 second video on the motivation for this PR"}),' (the last few seconds of the video also covers "transitional non-null" which is a ',(0,t.jsx)(r.a,{href:"https://github.com/graphql/graphql-spec/pull/1065",children:"separate concern"}),")."]}),"\n",(0,t.jsx)(r.p,{children:"As agreed at the nullability working group, disabling error propagation is the future of error handling in GraphQL. Error propagation causes a number of issues, but chief among them are:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"It destroys useful data in the response."}),"\n",(0,t.jsxs)(r.li,{children:["It makes it ",(0,t.jsx)(r.a,{href:"https://github.com/graphql/nullability-wg/discussions/23",children:"unsafe to store resulting data in normalized stores"}),"."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"Clients such as Relay do not want error propagation to be a thing."}),"\n",(0,t.jsxs)(r.p,{children:["This has traditionally resulted in schema design best practices advising using nullable in positions where errors were expected, even if ",(0,t.jsx)(r.code,{children:"null"})," was never a semantically valid value for that position. And since errors can happen everywhere, this has lead to an explosion of nullability and significant pain on the client side with developers having to do seemingly unnecessary null checks in loads of positions, or worse - unsafely bypassing the type safety."]}),"\n",(0,t.jsxs)(r.p,{children:['The reason that GraphQL does error propagation is to keep it\'s "not null" promise in the event that an error occurs (and is replaced with ',(0,t.jsx)(r.code,{children:"null"})," due to the way GraphQL responses are structured and limitations in JSON) in a non-nullable position."]}),"\n",(0,t.jsxs)(r.p,{children:["It doesn't take much code on the client to prevent the client reading a ",(0,t.jsx)(r.code,{children:"null"})," that relates to an error, ",(0,t.jsx)(r.a,{href:"https://www.npmjs.com/package/graphql-toe",children:"graphql-toe"})," can be used with almost any JavaScript or TypeScript based GraphQL client (not Relay, but it has ",(0,t.jsx)(r.code,{children:"@throwOnFieldError"})," that you can use instead) and achieves this ",(0,t.jsx)(r.a,{href:"https://bundlephobia.com/package/graphql-toe@1.0.0-rc.0",children:"in 512 bytes gzipped"})," - and that's with a focus on performance rather than bundle size."]}),"\n",(0,t.jsxs)(r.p,{children:["This PR allows the client to take responsibility for error handling by specifying ",(0,t.jsx)(r.code,{children:'onError: "NO_PROPAGATE"'})," as part of the GraphQL request, and thereby turns off error propagation behavior. This is also set as the recommended default for future schemas."]}),"\n",(0,t.jsxs)(r.p,{children:["With clients responsible for error handling, we no longer need to factor the possibility of whether something can error or not into its nullability, meaning we can use the not-null ",(0,t.jsx)(r.code,{children:"!"})," to indicate all the positions in the schema for which ",(0,t.jsx)(r.code,{children:"null"})," is not a semantically valid value - i.e. the underlying resource will never be a legitimate ",(0,t.jsx)(r.code,{children:"null"}),"."]}),"\n",(0,t.jsx)(r.p,{children:"The end result:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"true nullability indicated in schema - no more thinking about where errors are likely"}),"\n",(0,t.jsx)(r.li,{children:"fewer null checks on clients"}),"\n",(0,t.jsxs)(r.li,{children:["clients can leverage their native error handling capabilities such as try/catch or ",(0,t.jsx)(r.code,{children:"<ErrorBoundary />"})]}),"\n",(0,t.jsxs)(r.li,{children:["safe to store errored responses into normalized stores (",(0,t.jsx)(r.em,{children:"if"})," the response comes back with ",(0,t.jsx)(r.code,{children:'errors: "NO_PROPAGATE"'}),")"]}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsxs)(r.p,{children:["I've also included ",(0,t.jsx)(r.code,{children:'onError: "ABORT"'})," in this proposal. We've discovered that there's a small but significant class\u200b of clients out there, mostly ad-hoc scripts, that throw away the entire response when any error occurs. By codifying this into the spec we make it easier to implement these clients, and we allow the server to abort processing the rest of the request unnecessarily."]}),"\n"]})]})}function d(e={}){const{wrapper:r}={...(0,i.a)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},1151:(e,r,n)=>{n.d(r,{Z:()=>l,a:()=>s});var t=n(7294);const i={},a=t.createContext(i);function s(e){const r=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(a.Provider,{value:r},e.children)}}}]);
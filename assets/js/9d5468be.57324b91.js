"use strict";(self.webpackChunk_localrepo_benjie_dev=self.webpackChunk_localrepo_benjie_dev||[]).push([[8362],{8436:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>h});var n=i(5893),r=i(1151);const a={identifier:"860",title:"Prevent @skip and @include on root subscription selection set",stage:"3",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/860",events:[{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/05-May/01-wg-primary.md",date:new Date("2025-05-01T00:00:00.000Z"),actor:null},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/04-Apr/03-wg-primary.md",date:new Date("2025-04-03T00:00:00.000Z"),actor:null},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/03-Mar/06-wg-primary.md",date:new Date("2025-03-06T00:00:00.000Z"),actor:null},{type:"commitsPushed",date:new Date("2025-02-26T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",headline:"Merge branch 'main' into subscription-single-root-field",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/c22c75d9fb60938cf370eb4de718ccbaf0847ab9",headline:"Fix algorithm format",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",date:new Date("2023-12-07T00:00:00.000Z"),actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",date:"2023-12",actor:null},{type:"commitsPushed",date:new Date("2021-05-26T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",headline:"Use a modified copy of the CollectFields algorithm",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2021/2021-05-13.md",date:new Date("2021-05-13T00:00:00.000Z"),actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2021/2021-05-13.md",date:new Date("2021-05-13T00:00:00.000Z"),actor:null},{type:"prCreated",date:new Date("2021-04-25T11:26:37.000Z"),href:"https://github.com/graphql/graphql-spec/pull/860",actor:"benjie"},{type:"commitsPushed",date:new Date("2021-04-25T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",headline:"Prevent @skip and @include on root subscription selection set",ghUser:"benjie",authorName:"Benjie Gillam"}]}],shortname:"Prevent @skip and @include on root subscription selection set",image:"/img/rfc_tracker.png"},s=void 0,l={id:"860",title:"Prevent @skip and @include on root subscription selection set",description:"At a glance",source:"@site/rfcs/860.md",sourceDirName:".",slug:"/860",permalink:"/rfcs/860",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{identifier:"860",title:"Prevent @skip and @include on root subscription selection set",stage:"3",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/860",events:[{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/05-May/01-wg-primary.md",date:"2025-05-01T00:00:00.000Z",actor:null},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/04-Apr/03-wg-primary.md",date:"2025-04-03T00:00:00.000Z",actor:null},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/03-Mar/06-wg-primary.md",date:"2025-03-06T00:00:00.000Z",actor:null},{type:"commitsPushed",date:"2025-02-26T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",headline:"Merge branch 'main' into subscription-single-root-field",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/c22c75d9fb60938cf370eb4de718ccbaf0847ab9",headline:"Fix algorithm format",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",date:"2023-12-07T00:00:00.000Z",actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",date:"2023-12",actor:null},{type:"commitsPushed",date:"2021-05-26T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",headline:"Use a modified copy of the CollectFields algorithm",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2021/2021-05-13.md",date:"2021-05-13T00:00:00.000Z",actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2021/2021-05-13.md",date:"2021-05-13T00:00:00.000Z",actor:null},{type:"prCreated",date:"2021-04-25T11:26:37.000Z",href:"https://github.com/graphql/graphql-spec/pull/860",actor:"benjie"},{type:"commitsPushed",date:"2021-04-25T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",headline:"Prevent @skip and @include on root subscription selection set",ghUser:"benjie",authorName:"Benjie Gillam"}]}],shortname:"Prevent @skip and @include on root subscription selection set",image:"/img/rfc_tracker.png"},sidebar:"rfcsSidebar",previous:{title:"OneOf Input Objects",permalink:"/rfcs/825"},next:{title:"Implementations may not deprecate a field that the interface hasn't deprecated",permalink:"/rfcs/1053"}},o={},h=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Timeline",id:"timeline",level:2}];function c(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Identifier"}),": #860"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Stage"}),": ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-3-accepted",children:"RFC3: Accepted"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Champion"}),": ",(0,n.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"PR"}),": ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/pull/860",children:"Prevent @skip and @include on root subscription selection set"})]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"timeline",children:"Timeline"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.strong,{children:["Added to ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/05-May/01-wg-primary.md",children:"2025-05-01 WG agenda"})]})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.strong,{children:["Added to ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/04-Apr/03-wg-primary.md",children:"2025-04-03 WG agenda"})]})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.strong,{children:["Added to ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2025/03-Mar/06-wg-primary.md",children:"2025-03-06 WG agenda"})]})}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"2 commits pushed"})," on 2025-02-26:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",children:"Merge branch 'main' into subscription-single-root-field"})," by ",(0,n.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/c22c75d9fb60938cf370eb4de718ccbaf0847ab9",children:"Fix algorithm format"})," by ",(0,n.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.strong,{children:["Added to ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",children:"2023-12-07 WG agenda"})]})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.strong,{children:["Mentioned in ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",children:"2023-12 WG notes"})]})}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Commit pushed"}),": ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",children:"Use a modified copy of the CollectFields algorithm"})," on 2021-05-26 by ",(0,n.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.strong,{children:["Added to ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2021/2021-05-13.md",children:"2021-05-13 WG agenda"})]})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsxs)(t.strong,{children:["Mentioned in ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/notes/2021/2021-05-13.md",children:"2021-05-13 WG notes"})]})}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsxs)(t.strong,{children:[(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/pull/860",children:"Spec PR"})," created"]})," on 2021-04-25 by benjie"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Commit pushed"}),": ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",children:"Prevent @skip and @include on root subscription selection set"})," on 2021-04-25 by ",(0,n.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:["Following on from #776 and based on the ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-js/pull/2861#discussion_r619789288",children:"discussion in the GraphQL.js pull request"})," I'm still uncomfortable with the single root field validation rule for subscription operations."]}),"\n",(0,n.jsxs)(t.p,{children:['Currently the "single root field" algorithm sets ',(0,n.jsx)(t.code,{children:"variableValues"})," to be the empty set and then calls ",(0,n.jsx)(t.code,{children:"CollectFields"}),". To see the issue with this, consider the following subscription operation:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-graphql",children:"type Subscription {\n  mySubscriptionField1: Int\n  mySubscriptionField2: Int\n  mySubscriptionField3: Int\n}\n\nsubscription TwoFieldsByDefault($bool: Boolean = true) {\n  mySubscriptionField1 @skip(if: $bool)\n  mySubscriptionField2 @include(if: $bool)\n  mySubscriptionField3 @include(if: $bool)\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["A call to ",(0,n.jsx)(t.a,{href:"https://spec.graphql.org/draft/#CollectFields()",children:"CollectFields"})," passing an empty map for {variableValues} will result in all selections with ",(0,n.jsx)(t.code,{children:"@skip"})," directives being considered, and all selections with the ",(0,n.jsx)(t.code,{children:"@include"})," directive being skipped. So according to the current validation rule, this operation is valid - it only has one field ",(0,n.jsx)(t.code,{children:"mySubscriptionField1"})," (which is not an introspection field) in the root selection set."]}),"\n",(0,n.jsxs)(t.p,{children:["However, if you pass no variables at runtime, the runtime ",(0,n.jsx)(t.code,{children:"CollectFields()"})," called during ",(0,n.jsx)(t.a,{href:"https://spec.graphql.org/draft/#CreateSourceEventStream()",children:"CreateSourceEventStream"})," for the subscription operation will result in ",(0,n.jsx)(t.code,{children:"groupedFieldSet"})," containing two selections (",(0,n.jsx)(t.code,{children:"mySubscriptionField2"})," and ",(0,n.jsx)(t.code,{children:"mySubscriptionField3"}),"). This will result in a request error being raised: ",(0,n.jsx)(t.code,{children:"If groupedFieldSet does not have exactly one entry, raise a request error."})]}),"\n",(0,n.jsx)(t.p,{children:"This catches the invalid operation at runtime rather than validation time, giving a false sense of security about the validity of a GraphQL operation that may fail by default."}),"\n",(0,n.jsxs)(t.p,{children:["No other validation rule in the entire of Section 5 references ",(0,n.jsx)(t.code,{children:"variableValues"})," or calls ",(0,n.jsx)(t.code,{children:"CollectFields"}),"; but we already know that the root subscription selection set is very special (it's been discussed many times at the GraphQL Spec WG)."]}),"\n",(0,n.jsxs)(t.p,{children:["This PR proposes that ",(0,n.jsx)(t.code,{children:"@skip"})," and ",(0,n.jsx)(t.code,{children:"@include"})," are forbidden on root subscription selection sets."]}),"\n",(0,n.jsxs)(t.p,{children:["\ud83d\udea8"," This is a breaking change since previously valid operations such as the following will now be marked as invalid:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-graphql",children:"subscription ThisIsFineDotJpg($bool: Boolean = true) {\n  mySubscriptionField1 @skip(if: $bool)\n  mySubscriptionField2 @include(if: $bool)\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["GraphQL.js PR: ",(0,n.jsx)(t.a,{href:"https://github.com/graphql/graphql-js/pull/3974",children:"https://github.com/graphql/graphql-js/pull/3974"})]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},1151:(e,t,i)=>{i.d(t,{Z:()=>l,a:()=>s});var n=i(7294);const r={},a=n.createContext(r);function s(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);
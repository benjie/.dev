"use strict";(self.webpackChunk_localrepo_benjie_dev=self.webpackChunk_localrepo_benjie_dev||[]).push([[8362],{8436:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var n=t(5893),s=t(1151);const r={identifier:"860",title:"Prevent @skip and @include on root subscription selection set",stage:"3",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/860",events:[{type:"commitsPushed",date:new Date("2025-05-22T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/8e7d2a204721243bb897c683f460a869ab361381",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/8e7d2a204721243bb897c683f460a869ab361381",headline:"Merge branch 'main' into subscription-single-root-field",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"commitsPushed",date:new Date("2025-02-26T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",headline:"Merge branch 'main' into subscription-single-root-field",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/c22c75d9fb60938cf370eb4de718ccbaf0847ab9",headline:"Fix algorithm format",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"commitsPushed",date:new Date("2021-05-26T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",headline:"Use a modified copy of the CollectFields algorithm",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"prCreated",date:new Date("2021-04-25T11:26:37.000Z"),href:"https://github.com/graphql/graphql-spec/pull/860",actor:"benjie"},{type:"commitsPushed",date:new Date("2021-04-25T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",headline:"Prevent @skip and @include on root subscription selection set",ghUser:"benjie",authorName:"Benjie Gillam"}]}],shortname:"Prevent @skip and @include on root subscription selection set",image:"/img/rfc_tracker.png",closedAt:new Date("2025-06-05T18:25:31.000Z"),mergedAt:new Date("2025-06-05T18:25:31.000Z"),mergedBy:"leebyron",nextStage:!1},a=void 0,o={id:"860",title:"Prevent @skip and @include on root subscription selection set",description:"At a glance",source:"@site/rfcs/860.md",sourceDirName:".",slug:"/860",permalink:"/rfcs/860",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{identifier:"860",title:"Prevent @skip and @include on root subscription selection set",stage:"3",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/860",events:[{type:"commitsPushed",date:"2025-05-22T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/8e7d2a204721243bb897c683f460a869ab361381",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/8e7d2a204721243bb897c683f460a869ab361381",headline:"Merge branch 'main' into subscription-single-root-field",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"commitsPushed",date:"2025-02-26T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",headline:"Merge branch 'main' into subscription-single-root-field",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/c22c75d9fb60938cf370eb4de718ccbaf0847ab9",headline:"Fix algorithm format",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"commitsPushed",date:"2021-05-26T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",headline:"Use a modified copy of the CollectFields algorithm",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"prCreated",date:"2021-04-25T11:26:37.000Z",href:"https://github.com/graphql/graphql-spec/pull/860",actor:"benjie"},{type:"commitsPushed",date:"2021-04-25T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",headline:"Prevent @skip and @include on root subscription selection set",ghUser:"benjie",authorName:"Benjie Gillam"}]}],shortname:"Prevent @skip and @include on root subscription selection set",image:"/img/rfc_tracker.png",closedAt:"2025-06-05T18:25:31.000Z",mergedAt:"2025-06-05T18:25:31.000Z",mergedBy:"leebyron",nextStage:!1},sidebar:"rfcsSidebar",previous:{title:"Add descriptions to executable documents | 2025 Update",permalink:"/rfcs/1170"},next:{title:"Do not exclude schema keyword if schema has description",permalink:"/rfcs/1167"}},l={},c=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Timeline",id:"timeline",level:2}];function h(e){const i={a:"a",blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Identifier"}),": #860"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Stage"}),": ",(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-3-accepted",children:"RFC3: Accepted"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Champion"}),": ",(0,n.jsx)(i.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"PR"}),": ",(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-spec/pull/860",children:"Prevent @skip and @include on root subscription selection set"})]}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"timeline",children:"Timeline"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Commit pushed"}),": ",(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-spec/commit/8e7d2a204721243bb897c683f460a869ab361381",children:"Merge branch 'main' into subscription-single-root-field"})," on 2025-05-22 by ",(0,n.jsx)(i.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"2 commits pushed"})," on 2025-02-26:","\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-spec/commit/10e6a5e9a754cb2fd0646aefe7aafa1b175e7013",children:"Merge branch 'main' into subscription-single-root-field"})," by ",(0,n.jsx)(i.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-spec/commit/c22c75d9fb60938cf370eb4de718ccbaf0847ab9",children:"Fix algorithm format"})," by ",(0,n.jsx)(i.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Commit pushed"}),": ",(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-spec/commit/0308b27f1de82201b94e45ef83b5c18a4408a38a",children:"Use a modified copy of the CollectFields algorithm"})," on 2021-05-26 by ",(0,n.jsx)(i.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsxs)(i.strong,{children:[(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-spec/pull/860",children:"Spec PR"})," created"]})," on 2021-04-25 by benjie"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Commit pushed"}),": ",(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-spec/commit/5e742bbdc525f146399ad1f88566f270d440086d",children:"Prevent @skip and @include on root subscription selection set"})," on 2021-04-25 by ",(0,n.jsx)(i.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsxs)(i.blockquote,{children:["\n",(0,n.jsxs)(i.p,{children:["Following on from #776 and based on the ",(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-js/pull/2861#discussion_r619789288",children:"discussion in the GraphQL.js pull request"})," I'm still uncomfortable with the single root field validation rule for subscription operations."]}),"\n",(0,n.jsxs)(i.p,{children:['Currently the "single root field" algorithm sets ',(0,n.jsx)(i.code,{children:"variableValues"})," to be the empty set and then calls ",(0,n.jsx)(i.code,{children:"CollectFields"}),". To see the issue with this, consider the following subscription operation:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-graphql",children:"type Subscription {\n  mySubscriptionField1: Int\n  mySubscriptionField2: Int\n  mySubscriptionField3: Int\n}\n\nsubscription TwoFieldsByDefault($bool: Boolean = true) {\n  mySubscriptionField1 @skip(if: $bool)\n  mySubscriptionField2 @include(if: $bool)\n  mySubscriptionField3 @include(if: $bool)\n}\n"})}),"\n",(0,n.jsxs)(i.p,{children:["A call to ",(0,n.jsx)(i.a,{href:"https://spec.graphql.org/draft/#CollectFields()",children:"CollectFields"})," passing an empty map for {variableValues} will result in all selections with ",(0,n.jsx)(i.code,{children:"@skip"})," directives being considered, and all selections with the ",(0,n.jsx)(i.code,{children:"@include"})," directive being skipped. So according to the current validation rule, this operation is valid - it only has one field ",(0,n.jsx)(i.code,{children:"mySubscriptionField1"})," (which is not an introspection field) in the root selection set."]}),"\n",(0,n.jsxs)(i.p,{children:["However, if you pass no variables at runtime, the runtime ",(0,n.jsx)(i.code,{children:"CollectFields()"})," called during ",(0,n.jsx)(i.a,{href:"https://spec.graphql.org/draft/#CreateSourceEventStream()",children:"CreateSourceEventStream"})," for the subscription operation will result in ",(0,n.jsx)(i.code,{children:"groupedFieldSet"})," containing two selections (",(0,n.jsx)(i.code,{children:"mySubscriptionField2"})," and ",(0,n.jsx)(i.code,{children:"mySubscriptionField3"}),"). This will result in a request error being raised: ",(0,n.jsx)(i.code,{children:"If groupedFieldSet does not have exactly one entry, raise a request error."})]}),"\n",(0,n.jsx)(i.p,{children:"This catches the invalid operation at runtime rather than validation time, giving a false sense of security about the validity of a GraphQL operation that may fail by default."}),"\n",(0,n.jsxs)(i.p,{children:["No other validation rule in the entire of Section 5 references ",(0,n.jsx)(i.code,{children:"variableValues"})," or calls ",(0,n.jsx)(i.code,{children:"CollectFields"}),"; but we already know that the root subscription selection set is very special (it's been discussed many times at the GraphQL Spec WG)."]}),"\n",(0,n.jsxs)(i.p,{children:["This PR proposes that ",(0,n.jsx)(i.code,{children:"@skip"})," and ",(0,n.jsx)(i.code,{children:"@include"})," are forbidden on root subscription selection sets."]}),"\n",(0,n.jsxs)(i.p,{children:["\ud83d\udea8"," This is a breaking change since previously valid operations such as the following will now be marked as invalid:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-graphql",children:"subscription ThisIsFineDotJpg($bool: Boolean = true) {\n  mySubscriptionField1 @skip(if: $bool)\n  mySubscriptionField2 @include(if: $bool)\n}\n"})}),"\n",(0,n.jsxs)(i.p,{children:["GraphQL.js PR: ",(0,n.jsx)(i.a,{href:"https://github.com/graphql/graphql-js/pull/3974",children:"https://github.com/graphql/graphql-js/pull/3974"})]}),"\n"]})]})}function d(e={}){const{wrapper:i}={...(0,s.a)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},1151:(e,i,t)=>{t.d(i,{Z:()=>o,a:()=>a});var n=t(7294);const s={},r=n.createContext(s);function a(e){const i=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(r.Provider,{value:i},e.children)}}}]);
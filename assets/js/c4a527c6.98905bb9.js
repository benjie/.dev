"use strict";(self.webpackChunk_localrepo_benjie_dev=self.webpackChunk_localrepo_benjie_dev||[]).push([[6610],{901:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>o});var t=i(5893),s=i(1151);const a={identifier:"586",title:"Input Objects accepting exactly @oneField",stage:"0",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/586",events:[{type:"commitsPushed",date:new Date("2019-07-22T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/96182a0cee695e9c42ba028b2c9bc9ceb8f641c3",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/96182a0cee695e9c42ba028b2c9bc9ceb8f641c3",headline:"Merge branch 'master' into one-field",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/bba008cc44a322f30da146b197464dbd14d3e36a",headline:"Fix lint issue",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"commitsPushed",date:new Date("2019-06-13T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/3c181d1c610ca9d0be1d142664ba2967e87087a3",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/3c181d1c610ca9d0be1d142664ba2967e87087a3",headline:"Tweak wording for when IDL directive is required",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"commitsPushed",date:new Date("2019-06-12T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/8bba50b132c07ef574b210d01fec9bd03e3aa776",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/8bba50b132c07ef574b210d01fec9bd03e3aa776",headline:"Tweak wording: accepts -> requires",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2019/2019-06-06.md",date:new Date("2019-06-06T00:00:00.000Z"),actor:null},{type:"commitsPushed",date:new Date("2019-05-23T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/d08eae1bee20781c9a2cad46067a6ee0a5a02286",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/d08eae1bee20781c9a2cad46067a6ee0a5a02286",headline:"may -> must",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"prCreated",date:new Date("2019-05-18T13:58:21.000Z"),href:"https://github.com/graphql/graphql-spec/pull/586",actor:"benjie"},{type:"commitsPushed",date:new Date("2019-05-18T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/f97b8c566ae49405fce8b4c78c6ab2e85719db91",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/f97b8c566ae49405fce8b4c78c6ab2e85719db91",headline:"Add specification changes for @oneField directive",ghUser:"benjie",authorName:"Benjie Gillam"}]}],related:"395, 733, 825, InputUnion",shortname:"Input Objects accepting exactly @oneField",image:"/img/rfc_tracker.png",closedAt:new Date("2019-11-05T22:43:17.000Z")},r=void 0,l={id:"586",title:"Input Objects accepting exactly @oneField",description:"At a glance",source:"@site/rfcs/586.md",sourceDirName:".",slug:"/586",permalink:"/rfcs/586",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{identifier:"586",title:"Input Objects accepting exactly @oneField",stage:"0",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/586",events:[{type:"commitsPushed",date:"2019-07-22T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/96182a0cee695e9c42ba028b2c9bc9ceb8f641c3",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/96182a0cee695e9c42ba028b2c9bc9ceb8f641c3",headline:"Merge branch 'master' into one-field",ghUser:"benjie",authorName:"Benjie Gillam"},{href:"https://github.com/graphql/graphql-spec/commit/bba008cc44a322f30da146b197464dbd14d3e36a",headline:"Fix lint issue",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"commitsPushed",date:"2019-06-13T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/3c181d1c610ca9d0be1d142664ba2967e87087a3",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/3c181d1c610ca9d0be1d142664ba2967e87087a3",headline:"Tweak wording for when IDL directive is required",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"commitsPushed",date:"2019-06-12T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/8bba50b132c07ef574b210d01fec9bd03e3aa776",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/8bba50b132c07ef574b210d01fec9bd03e3aa776",headline:"Tweak wording: accepts -> requires",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2019/2019-06-06.md",date:"2019-06-06T00:00:00.000Z",actor:null},{type:"commitsPushed",date:"2019-05-23T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/d08eae1bee20781c9a2cad46067a6ee0a5a02286",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/d08eae1bee20781c9a2cad46067a6ee0a5a02286",headline:"may -> must",ghUser:"benjie",authorName:"Benjie Gillam"}]},{type:"prCreated",date:"2019-05-18T13:58:21.000Z",href:"https://github.com/graphql/graphql-spec/pull/586",actor:"benjie"},{type:"commitsPushed",date:"2019-05-18T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/f97b8c566ae49405fce8b4c78c6ab2e85719db91",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/f97b8c566ae49405fce8b4c78c6ab2e85719db91",headline:"Add specification changes for @oneField directive",ghUser:"benjie",authorName:"Benjie Gillam"}]}],related:"395, 733, 825, InputUnion",shortname:"Input Objects accepting exactly @oneField",image:"/img/rfc_tracker.png",closedAt:"2019-11-05T22:43:17.000Z"},sidebar:"rfcsSidebar",previous:{title:"__typename should be valid at subscription root",permalink:"/rfcs/806"},next:{title:"Limit uniqueness to `@skip`, `@include` and `@deprecated` directives",permalink:"/rfcs/471"}},c={},o=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Timeline",id:"timeline",level:2},{value:"Explanation of the problem",id:"explanation-of-the-problem",level:2},{value:"Prior Art",id:"prior-art",level:2},{value:"The input object <code>requiresExactlyOneField</code> property (exposed via <code>@oneField</code>)",id:"the-input-object-requiresexactlyonefield-property-exposed-via-onefield",level:3},{value:"Example 1",id:"example-1",level:3},{value:"Example 2",id:"example-2",level:3},{value:"Example 3",id:"example-3",level:3},{value:"Guiding principles",id:"guiding-principles",level:2},{value:"Backwards Compatibility",id:"backwards-compatibility",level:3},{value:"Performance is a feature",id:"performance-is-a-feature",level:3},{value:"Favour no change",id:"favour-no-change",level:3},{value:"Enable new capabilities motivated by real use cases",id:"enable-new-capabilities-motivated-by-real-use-cases",level:3},{value:"Simplicity and consistency over expressiveness and terseness",id:"simplicity-and-consistency-over-expressiveness-and-terseness",level:3},{value:"Preserve option value",id:"preserve-option-value",level:3},{value:"Understandability is just as important as correctness",id:"understandability-is-just-as-important-as-correctness",level:3},{value:"Comparison with inputUnion",id:"comparison-with-inputunion",level:2},{value:"Potential concerns, challenges and drawbacks",id:"potential-concerns-challenges-and-drawbacks",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Identifier"}),": #586"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Stage"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-x-rejected",children:"RFCX: Closed"})," 2019-11-05T22:43:17Z"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Champion"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"PR"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/pull/586",children:"Input Objects accepting exactly @oneField"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Related"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/rfcs/395",title:"inputUnion type / RFCX",children:"#395"})," (inputUnion type)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/rfcs/733",title:"Tagged type / RFCX",children:"#733"})," (Tagged type)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/rfcs/825",title:"OneOf Input Objects / RFC3",children:"#825"})," (OneOf Input Objects)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/rfcs/InputUnion",title:"GraphQL Input Union / RFC0",children:"InputUnion"})," (GraphQL Input Union)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"timeline",children:"Timeline"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"2 commits pushed"})," on 2019-07-22:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/commit/96182a0cee695e9c42ba028b2c9bc9ceb8f641c3",children:"Merge branch 'master' into one-field"})," by ",(0,t.jsx)(n.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/commit/bba008cc44a322f30da146b197464dbd14d3e36a",children:"Fix lint issue"})," by ",(0,t.jsx)(n.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Commit pushed"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/commit/3c181d1c610ca9d0be1d142664ba2967e87087a3",children:"Tweak wording for when IDL directive is required"})," on 2019-06-13 by ",(0,t.jsx)(n.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Commit pushed"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/commit/8bba50b132c07ef574b210d01fec9bd03e3aa776",children:"Tweak wording: accepts -> requires"})," on 2019-06-12 by ",(0,t.jsx)(n.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsxs)(n.strong,{children:["Mentioned in ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-wg/blob/main/notes/2019/2019-06-06.md",children:"2019-06-06 WG notes"})]})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Commit pushed"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/commit/d08eae1bee20781c9a2cad46067a6ee0a5a02286",children:"may -> must"})," on 2019-05-23 by ",(0,t.jsx)(n.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/pull/586",children:"Spec PR"})," created"]})," on 2019-05-18 by benjie"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Commit pushed"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/commit/f97b8c566ae49405fce8b4c78c6ab2e85719db91",children:"Add specification changes for @oneField directive"})," on 2019-05-18 by ",(0,t.jsx)(n.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"This is an RFC for adding explicit GraphQL support (and with it improved type safety) for a pattern that supports inputs of multiple types (composite and scalar)."}),"\n",(0,t.jsx)(n.h2,{id:"explanation-of-the-problem",children:"Explanation of the problem"}),"\n",(0,t.jsx)(n.p,{children:"Often a GraphQL field needs to accept one of many input types."}),"\n",(0,t.jsxs)(n.p,{children:["Example 1 (below) outlines the need for the ",(0,t.jsx)(n.code,{children:"addContent"})," mutation to accept a range of different content types."]}),"\n",(0,t.jsxs)(n.p,{children:["Example 2 (below) outlines the need for the ",(0,t.jsx)(n.code,{children:"findPosts"})," record finder to accept a range of different filtering criteria."]}),"\n",(0,t.jsx)(n.p,{children:"Currently in GraphQL the type safe solution to this is to have different fields, one per type:"}),"\n",(0,t.jsx)(n.p,{children:'Example 1 (more details in "Example 1" section below):'}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"addPostContent(post: [PostInput!]!)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"addImageContent(image: [ImageInput!]!)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"addHrefContent(href: [String!]!)"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Note to add lots of content blocks of different types you must add multiple mutations to your GraphQL request, which is a lot less efficient and loses the transactional nature of the request."}),"\n",(0,t.jsx)(n.p,{children:'Example 2 (more details in "Example 2" section below):'}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"findPostsByIds(ids: [Int!])"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"findPostsMatchingConditions(conditions: [PostCondition!])"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:'Another solution is the "tagged input union" pattern, which results in a less overwhelming schema thanks to fewer fields, solves the issue of inputting lots of data in a single mutation, but loses type safety:'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:"input MediaBlock {\n  post: PostInput\n  image: ImageInput\n  href: String\n}\nextend type Mutation {\n  addContent(content: [MediaBlock!]!): AddContentPayload\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"(The loss of type safety is that each block should require\u200b that exactly one of the fields is set, however GraphQL does not enforce this so it must be done at run-time, and generic tooling will not be able to confirm the validity of inputs.)"}),"\n",(0,t.jsx)(n.h2,{id:"prior-art",children:"Prior Art"}),"\n",(0,t.jsxs)(n.p,{children:['This RFC is similar to the "tagged input union" pattern discussed as an alternative in the ',(0,t.jsx)(n.code,{children:"inputUnion"})," RFC #395 (please see the reasons people may not be happy with it there also). Since we are failing to reach consensus of on the ",(0,t.jsx)(n.code,{children:"inputUnion"})," type in that proposal, I'd like to revisit ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/pull/395#issuecomment-361373097",children:"Lee's original counter-proposal"})," with the small addition of a directive to require\u200b that exactly one field be present on the input object (as ",(0,t.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/pull/395#issuecomment-361704974",children:"originally proposed by Ivan"}),")."]}),"\n",(0,t.jsxs)(n.h3,{id:"the-input-object-requiresexactlyonefield-property-exposed-via-onefield",children:["The input object ",(0,t.jsx)(n.code,{children:"requiresExactlyOneField"})," property (exposed via ",(0,t.jsx)(n.code,{children:"@oneField"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:["This new ",(0,t.jsx)(n.code,{children:"requiresExactlyOneField"})," introspection property for input objects can be exposed via IDL as the ",(0,t.jsx)(n.code,{children:"@oneField"})," directive (in a similar way to how the ",(0,t.jsx)(n.code,{children:"deprecationReason"})," introspection property is exposed as ",(0,t.jsx)(n.code,{children:"@deprecated(reason: ...)"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"This property applies to an input object type:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:"input MyInput @oneField {\n  field1: Type1\n  field2: Type2\n  field3: Type3\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["(In the IDL, we could alternatively expose it as a different type: ",(0,t.jsx)(n.code,{children:"inputOne MyInput"}),", rather than ",(0,t.jsx)(n.code,{children:"input MyInput @oneField"}),", if using a directive was found to be confusing.)"]}),"\n",(0,t.jsxs)(n.p,{children:["The fields of an input object type defined with ",(0,t.jsx)(n.code,{children:"@oneField"})," must all be nullable, and must not have default values. On input, exactly one field must be specified, and its value must not be null."]}),"\n",(0,t.jsx)(n.p,{children:"(For the avoidance of doubt: the field types may be scalars or input objects, and the same type may be specified for multiple fields. This is the same as for regular input objects.)"}),"\n",(0,t.jsxs)(n.p,{children:["I've called the flag ",(0,t.jsx)(n.code,{children:"@oneField"})," (and the related introspection field ",(0,t.jsx)(n.code,{children:"requireExactlyOneField"}),"), but it could equally be called ",(0,t.jsx)(n.code,{children:"@requireExactlyOneField"}),", ",(0,t.jsx)(n.code,{children:"@exactlyOne"}),", ",(0,t.jsx)(n.code,{children:"@one"}),", or many other variants depending on your position in the terseness vs explicitness spectrum."]}),"\n",(0,t.jsx)(n.h3,{id:"example-1",children:"Example 1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'input PostInput {\n  title: String!\n  body: String!\n}\n\ninput ImageInput {\n  photo: String!\n  caption: String\n}\n\n"""\nEach media block can be one (and only one) of these types.\n"""\ninput MediaBlock @oneField {\n  post: PostInput\n  image: ImageInput\n  href: String\n}\n\ntype Mutation {\n  addContent(content: [MediaBlock!]!): Post\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:"mutation AddContent($content: [MediaBlock!]!) {\n  addContent(content: $content) {\n    id\n  }\n}\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example input:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{\n  content: [\n    { post: { title: "@oneField directive", body: "..." } },\n    { image: { photo: "https://..." } },\n    { href: "https://graphql.org" }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"example-2",children:"Example 2"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'"""\nOptions available for matching a post title\n"""\ninput PostTitleFilter @oneField {\n  equals: String\n  contains: String\n  doesNotContain: String\n}\n\n"""\nYou may search within the title of the post, or within it\'s full text.\n"""\ninput PostCondition @oneField {\n  title: PostTitleFilter\n  fullTextSearch: String\n}\n\n"""\nIdentify the relevant posts either by a list of IDs, or a list of conditions\nfor them to match.\n"""\ninput PostMatch @oneField {\n  ids: [Int!]\n  conditions: [PostCondition!]\n}\n\ntype Query {\n  findPosts(matching: PostMatch!): [Post!]\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:"query FindPosts($matching: PostMatch!) {\n  findPosts(matching: $matching) {\n    id\n    title\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example inputs:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"{\n  matching: {\n    ids: [27, 30, 93]\n  }\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{\n  matching: {\n    conditions: [\n      { fullTextSearch: "GraphQL" },\n      { title: { contains: "Facebook" } }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"example-3",children:"Example 3"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'input OrganizationAndEmailInput {\n  organization: String!\n  email: String!\n}\n\n"""\nConditions that uniquely identify a user, supply exactly one.\n"""\ninput UserWhere @oneField {\n  id: ID\n  databaseId: Int\n  organizationAndEmail: OrganizationAndEmailInput\n  username: String\n}\n\ntype Query {\n  getUser(where: UserWhere!): User\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:"query GetUser($where: UserWhere!) {\n  getUser(where: $where) { id databaseId username email organization { id name slug } }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example inputs:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"{ where: { id: 27 } }\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{ where: { username: "Benjie" } }\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{\n  where: {\n    organizationAndEmail: {\n      organization: "graphql-wg",\n      email: "example@example.com"\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"guiding-principles",children:"Guiding principles"}),"\n",(0,t.jsx)(n.h3,{id:"backwards-compatibility",children:"Backwards Compatibility"}),"\n",(0,t.jsxs)(n.p,{children:["This change involves a small addition to the introspection system. Old clients will continue to work as they do currently, and can issue requests involving ",(0,t.jsx)(n.code,{children:"@oneField"})," input objects without needing to be updated, they simply will not benefit from the type validation of knowing exactly one field is required."]}),"\n",(0,t.jsx)(n.p,{children:"All pre-existing queries (and schemas) will still be valid, and old clients can query servers that support this feature without loss of functionality."}),"\n",(0,t.jsx)(n.h3,{id:"performance-is-a-feature",children:"Performance is a feature"}),"\n",(0,t.jsxs)(n.p,{children:["There is minimal overhead in this change; input objects continue to work as they did before, with one additional validation rule (that exactly one field must be specified). This can be asserted during the regular ",(0,t.jsx)(n.a,{href:"https://graphql.github.io/graphql-spec/draft/#sec-Input-Object-Required-Fields",children:"Input Object Required Fields Validation"})," at very little cost. (In the spec I've written it up as a separate rule, but implementations can implement this more efficiently.)"]}),"\n",(0,t.jsx)(n.h3,{id:"favour-no-change",children:"Favour no change"}),"\n",(0,t.jsxs)(n.p,{children:["The change itself is small (and hopefully easy to implement), whilst bringing significant value to type safety. It's not possible to represent this use case in a type safe way in GraphQL currently, without having a proliferation of object type fields such as ",(0,t.jsx)(n.code,{children:"addPostMediaBlock"}),", ",(0,t.jsx)(n.code,{children:"addImageMediaBlock"}),", ... (which gets even more complex when there's nested concerns)."]}),"\n",(0,t.jsx)(n.h3,{id:"enable-new-capabilities-motivated-by-real-use-cases",children:"Enable new capabilities motivated by real use cases"}),"\n",(0,t.jsxs)(n.p,{children:["It's clear from #395 and #488 (plus the multiple discussions during GraphQL working groups, and the community engagement) that a feature such as this is required. It's currently possible to express this in GraphQL (simply omit the ",(0,t.jsx)(n.code,{children:"@oneField"})," directive in the examples above), however it is not expressed in a type-safe way and requires the schema's resolvers to perform validation, resulting in run-time rather than compile-time errors (and no hinting in editors/tooling)."]}),"\n",(0,t.jsx)(n.h3,{id:"simplicity-and-consistency-over-expressiveness-and-terseness",children:"Simplicity and consistency over expressiveness and terseness"}),"\n",(0,t.jsx)(n.p,{children:"I believe this has been achieved (bike-shedding over the directive name notwithstanding)."}),"\n",(0,t.jsx)(n.h3,{id:"preserve-option-value",children:"Preserve option value"}),"\n",(0,t.jsxs)(n.p,{children:["This RFC is only on using this directive with input objects, I have been deliberately strict to keep the conversation on topic. There is room for expansion (and even for the addition of an explicit ",(0,t.jsx)(n.code,{children:"inputUnion"}),") in future."]}),"\n",(0,t.jsx)(n.h3,{id:"understandability-is-just-as-important-as-correctness",children:"Understandability is just as important as correctness"}),"\n",(0,t.jsx)(n.p,{children:"I've done my best; please suggest edits that may make the spec changes more clear \ud83d\udc4d"}),"\n",(0,t.jsx)(n.h2,{id:"comparison-with-inputunion",children:"Comparison with inputUnion"}),"\n",(0,t.jsx)(n.p,{children:'The field name takes the place of the "discriminator" discussed in #395.'}),"\n",(0,t.jsx)(n.p,{children:"The implementation is significantly simpler, for example the only change required to support autocompletion in GraphiQL is to stop autocompleting once one field has been supplied."}),"\n",(0,t.jsxs)(n.p,{children:["The implementation is backwards compatible: older clients may query a schema that uses ",(0,t.jsx)(n.code,{children:"@oneField"})," without loss of functionality."]}),"\n",(0,t.jsxs)(n.p,{children:["The implementation is forwards compatible: newer clients may query a schema that implements an older GraphQL version without causing any issues (whereas the unexpected addition of ",(0,t.jsx)(n.code,{children:"__inputname"})," may break existing GraphQL servers, hence complexity of only specifying it where a union is used)."]}),"\n",(0,t.jsxs)(n.p,{children:["There's no ",(0,t.jsx)(n.code,{children:"__inputname"})," / ",(0,t.jsx)(n.code,{children:"__typename"})," required, and heterogeneous input types are still supported."]}),"\n",(0,t.jsx)(n.p,{children:"The field types may be input objects or scalars."}),"\n",(0,t.jsx)(n.p,{children:"This pattern is already in use in the wild, but with the execution layer handling validation, rather than the schema itself."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"@oneField"})," does not mirror output unions/interfaces."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"@oneField"})," increases the depth of input objects vs the ",(0,t.jsx)(n.code,{children:"inputUnion"})," proposal (but, interestingly, does not increase the size of the request:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'# `inputUnion` example\n{ pets: [\n  { __inputname: "Cat", lives: 3 },\n  { __inputname: "Dog", wagging: true }\n]}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# `@exactlyOne` example\n{ pets: [\n  { cat: { lives: 3 } }\n  { dog: { wagging: true } }\n]}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"potential-concerns-challenges-and-drawbacks",children:"Potential concerns, challenges and drawbacks"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["It's not called an ",(0,t.jsx)(n.code,{children:"input union"}),", and does not mirror the ",(0,t.jsx)(n.code,{children:"union"})," syntax for output types"]}),"\n",(0,t.jsx)(n.li,{children:"It is not an ideal syntax (is there one?), and adds an additional layer of depth to input objects"}),"\n",(0,t.jsxs)(n.li,{children:["It requires a small addition to the introspection system: ",(0,t.jsx)(n.code,{children:"requiresExactlyOneField"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This pattern is already used in the wild, and the introduction of this feature will not break any existing APIs. APIs that already use this pattern could benefit from this feature retroactively without needing to update any any existing clients."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>r});var t=i(7294);const s={},a=t.createContext(s);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);
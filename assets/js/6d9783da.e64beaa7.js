"use strict";(self.webpackChunk_localrepo_benjie_dev=self.webpackChunk_localrepo_benjie_dev||[]).push([[5979],{5589:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var i=r(5893),t=r(1151);const s={identifier:"DisableErrorPropagationDirective",stage:"0",title:"Disable Error Propagation Directive",events:[{type:"docCreated",date:new Date("2025-03-19T13:44:40.000Z"),href:"https://github.com/graphql/graphql-wg/blob/7032c7f032c0ed9776cab3ac4b52037116782d2f/rfcs/DisableErrorPropagationDirective.md",actor:"Alex Reilly"}],related:"1050",shortname:"Disable Error Propagation Directive",image:"/img/rfc_tracker.png"},o=void 0,l={id:"DisableErrorPropagationDirective",title:"Disable Error Propagation Directive",description:"At a glance",source:"@site/rfcs/DisableErrorPropagationDirective.md",sourceDirName:".",slug:"/DisableErrorPropagationDirective",permalink:"/rfcs/DisableErrorPropagationDirective",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{identifier:"DisableErrorPropagationDirective",stage:"0",title:"Disable Error Propagation Directive",events:[{type:"docCreated",date:"2025-03-19T13:44:40.000Z",href:"https://github.com/graphql/graphql-wg/blob/7032c7f032c0ed9776cab3ac4b52037116782d2f/rfcs/DisableErrorPropagationDirective.md",actor:"Alex Reilly"}],related:"1050",shortname:"Disable Error Propagation Directive",image:"/img/rfc_tracker.png"},sidebar:"rfcsSidebar",previous:{title:"Allow singular variables in list locations",permalink:"/rfcs/509"},next:{title:"Directive proposal for opting out of null bubbling",permalink:"/rfcs/1050"}},a={},c=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Timeline",id:"timeline",level:2},{value:"\ud83d\udcdc Problem Statement",id:"-problem-statement",level:2},{value:"Current Behavior",id:"current-behavior",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"\u2705 RFC Goals",id:"-rfc-goals",level:2},{value:"\ud83d\udeab RFC Non-goals",id:"-rfc-non-goals",level:2},{value:"\ud83e\uddd1\u200d\ud83d\udcbb Proposed Solution",id:"-proposed-solution",level:2},{value:"Example",id:"example",level:3},{value:"\ud83d\udee0\ufe0f Implementation Considerations",id:"\ufe0f-implementation-considerations",level:2},{value:"\ud83d\uddfa\ufe0f Migration Path",id:"\ufe0f-migration-path",level:2},{value:"\ud83e\udd14 Alternatives Considered",id:"-alternatives-considered",level:2},{value:"Configurable Error Behavior",id:"configurable-error-behavior",level:3},{value:"\ud83d\udcdd Conclusion",id:"-conclusion",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Identifier"}),": DisableErrorPropagationDirective"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Stage"}),": ",(0,i.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-0-strawman",children:"RFC0: Strawman"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Champion"}),": -"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PR"}),": -"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Related"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/rfcs/1050",title:"Directive proposal for opting out of null bubbling / RFC0",children:"#1050"})," (Directive proposal for opting out of null bubbling)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"timeline",children:"Timeline"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://github.com/graphql/graphql-wg/blob/7032c7f032c0ed9776cab3ac4b52037116782d2f/rfcs/DisableErrorPropagationDirective.md",children:"RFC document created"})})," on 2025-03-19 by Alex Reilly"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.h1,{id:"rfc-disable-error-propagation-directive",children:"RFC: Disable Error Propagation Directive"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Proposed by:"})," ",(0,i.jsx)(n.a,{href:"https://github.com/martinbonnin",children:"Martin Bonnin"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"See also:"})," ",(0,i.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/pull/1050",children:"Original proposal/spec edits by Benjie"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Implementation PR"}),": ",(0,i.jsx)(n.a,{href:"https://github.com/graphql/graphql-js/pull/4348",children:"https://github.com/graphql/graphql-js/pull/4348"})]}),"\n",(0,i.jsxs)(n.p,{children:["This RFC proposes adding a new directive ",(0,i.jsx)(n.code,{children:"@disableErrorPropagation"})," that allows clients to disable error propagation for specific operations in their GraphQL queries."]}),"\n",(0,i.jsx)(n.h2,{id:"-problem-statement",children:"\ud83d\udcdc Problem Statement"}),"\n",(0,i.jsx)(n.p,{children:"In GraphQL, nullability serves two distinct purposes:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Semantic null"}),': Indicating that a field can have a legitimate "null" value (e.g., a user without an avatar)']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Error handling"}),": Allowing errors to propagate up through nullable parent fields"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This coupling of nullability and errors makes it difficult for clients to distinguish between semantic nulls and error states by looking at the schema. When a field resolver throws an error and the field is non-nullable, the error propagates up through parent fields until it reaches a nullable field, potentially nullifying a large portion of the response."}),"\n",(0,i.jsx)(n.p,{children:"While this behavior helps maintain data consistency guarantees, there are cases where clients may want more granular control over error propagation, particularly when partial data is preferable to no data."}),"\n",(0,i.jsx)(n.h3,{id:"current-behavior",children:"Current Behavior"}),"\n",(0,i.jsx)(n.p,{children:"Consider this schema:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"type User {\n  id: ID!\n  name: String\n  posts: [Post!]!\n  optionalPosts: [Post!]\n}\n\ntype Post {\n  id: ID!\n  title: String!\n  content: String\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If a resolver for ",(0,i.jsx)(n.code,{children:"Post.title"})," throws an error:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The error is added to the ",(0,i.jsx)(n.code,{children:"errors"})," array in the response"]}),"\n",(0,i.jsxs)(n.li,{children:["Since ",(0,i.jsx)(n.code,{children:"title"})," is non-nullable (",(0,i.jsx)(n.code,{children:"String!"}),"), its parent ",(0,i.jsx)(n.code,{children:"Post"})," object must be null"]}),"\n",(0,i.jsxs)(n.li,{children:["Since the array items are non-nullable (",(0,i.jsx)(n.code,{children:"[Post!]"}),"), the entire ",(0,i.jsx)(n.code,{children:"posts"})," array must be null"]}),"\n",(0,i.jsxs)(n.li,{children:["Since ",(0,i.jsx)(n.code,{children:"posts"})," is non-nullable (",(0,i.jsx)(n.code,{children:"[Post!]!"}),"), its parent ",(0,i.jsx)(n.code,{children:"User"})," object must be null"]}),"\n",(0,i.jsx)(n.li,{children:"This continues up the response tree until reaching a nullable field"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For the ",(0,i.jsx)(n.code,{children:"optionalPosts"})," field, which is nullable (",(0,i.jsx)(n.code,{children:"[Post!]"}),"), the propagation would stop at that field, setting it to null."]}),"\n",(0,i.jsx)(n.p,{children:"This behavior ensures type safety but can lead to situations where a single error in a deeply nested non-nullable field causes a large portion of the response to be nullified, even when the remaining data might still be useful to the client."}),"\n",(0,i.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Normalized Cache Protection"}),": When clients like Relay maintain a normalized cache, error propagation can cause cache corruption. For example, if two different queries fetch the same entity but one query errors on a non-nullable field, the error propagation can cause valid data from the other query to be nullified in the cache. Disabling error propagation allows clients to preserve valid data in their normalized caches while still handling errors appropriately."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Partial Data Acceptance"}),": In some applications, receiving partial data with errors is preferable to receiving null. For example, in a feed-style application, if one post fails to load, the client might still want to display the other posts."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fine-grained Error Control"}),": Clients may want to specify different error handling behaviors for different parts of their queries based on their application requirements."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-rfc-goals",children:"\u2705 RFC Goals"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Provide a way for clients to disable error propagation for specific operations"}),"\n",(0,i.jsx)(n.li,{children:"Help uncouple nullability and error handling in GraphQL"}),"\n",(0,i.jsx)(n.li,{children:"Support the transition to more semantically accurate nullability in schemas"}),"\n",(0,i.jsx)(n.li,{children:"Maintain backward compatibility with existing GraphQL behavior"}),"\n",(0,i.jsx)(n.li,{children:"Keep the implementation simple and focused"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-rfc-non-goals",children:"\ud83d\udeab RFC Non-goals"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This is not intended to be a general-purpose error handling solution"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-proposed-solution",children:"\ud83e\uddd1\u200d\ud83d\udcbb Proposed Solution"}),"\n",(0,i.jsxs)(n.p,{children:["Add a new directive ",(0,i.jsx)(n.code,{children:"@disableErrorPropagation"})," that can be applied to operations in executable documents:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"directive @disableErrorPropagation on QUERY | MUTATION | SUBSCRIPTION\n\nquery GetUserPosts @disableErrorPropagation {\n  user {\n    id\n    name\n    posts {\n      id\n      title\n      content\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"When this directive is present on an operation:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Errors thrown during execution will still be added to the ",(0,i.jsx)(n.code,{children:"errors"})," array"]}),"\n",(0,i.jsx)(n.li,{children:"The errors will not cause nullability violations to propagate up through parent fields"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:"Given these types:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"type User {\n  id: ID!\n  name: String\n  posts: [Post!]!\n}\n\ntype Post {\n  id: ID!\n  title: String!\n  content: String\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"And this query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"query GetUserPosts @disableErrorPropagation {\n  user {\n    id\n    name\n    posts {\n      id\n      title\n      content\n    }\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"title"})," resolver for one of the posts throws an error:"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Current behavior"})," (without directive):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "Failed to load title",\n      "path": ["user", "posts", 0, "title"]\n    }\n  ]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"With @disableErrorPropagation"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "user": {\n      "id": "123",\n      "name": "Alice",\n      "posts": [\n        {\n          "id": "post1",\n          "title": null,\n          "content": "Some content"\n        }\n      ]\n    }\n  },\n  "errors": [\n    {\n      "message": "Failed to load title",\n      "path": ["user", "posts", 0, "title"]\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-implementation-considerations",children:"\ud83d\udee0\ufe0f Implementation Considerations"}),"\n",(0,i.jsx)(n.p,{children:"The implementation requires changes to the execution algorithm in graphql-js:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["During operation execution, check if the operation has the ",(0,i.jsx)(n.code,{children:"@disableErrorPropagation"})," directive"]}),"\n",(0,i.jsx)(n.li,{children:"If present, modify error handling to prevent propagation while still collecting errors"}),"\n",(0,i.jsx)(n.li,{children:"Return field values as-is, even if errors occurred"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"While this proposal focuses on a simple boolean directive, future extensions might consider additional error behaviors:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PROPAGATE"}),": Current default behavior (errors propagate up)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"NULL"}),": Replace errored positions with null"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ABORT"}),": Abort the entire request on any error"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These additional behaviors are not part of this proposal but may be considered in future iterations."}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-migration-path",children:"\ud83d\uddfa\ufe0f Migration Path"}),"\n",(0,i.jsx)(n.p,{children:"For client authors wishing to adopt this feature:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Ensure your GraphQL server implementation supports ",(0,i.jsx)(n.code,{children:"@disableErrorPropagation"}),". Clients can check for directive support by looking for the existence of the directive on introspection."]}),"\n",(0,i.jsx)(n.li,{children:"Update client code to handle both nulls and errors appropriately."}),"\n",(0,i.jsxs)(n.li,{children:["Add the directive to operations where you want to prevent error propagation. Many clients, especially those with normalized caches, will wish to apply ",(0,i.jsx)(n.code,{children:"@disableErrorPropagation"})," to all operations."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For schema authors wishing to adopt this feature:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Update servers to a version that has support for ",(0,i.jsx)(n.code,{children:"@disableErrorPropagation"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Once upgraded, schema authors may feel more comfortable using non-nullable fields. We'll want to keep an eye on that and how it affects developers using older or simpler clients."}),"\n",(0,i.jsx)(n.h2,{id:"-alternatives-considered",children:"\ud83e\udd14 Alternatives Considered"}),"\n",(0,i.jsx)(n.h3,{id:"configurable-error-behavior",children:"Configurable Error Behavior"}),"\n",(0,i.jsx)(n.p,{children:"Instead of a simple boolean directive, we could provide an enum of error behaviors:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'enum ErrorBehavior {\n  """\n  Non-nullable positions that error cause the error to propagate to the nearest nullable\n  ancestor position. The error is added to the "errors" list.\n  """\n  PROPAGATE\n\n  """\n  Positions that error are replaced with a `null` and an error is added to the "errors"\n  list.\n  """\n  NULL\n\n  """\n  If any error occurs, abort the entire request and just return the error in the "errors"\n  list. (No partial success.)\n  """\n  ABORT\n}\n\ndirective @errorBehavior(behavior: ErrorBehavior!) on QUERY | MUTATION | SUBSCRIPTION\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The simple boolean ",(0,i.jsx)(n.code,{children:"@disableErrorPropagation"})," directive was chosen as it:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Addresses the most common use case (wanting partial data)"}),"\n",(0,i.jsx)(n.li,{children:"Maintains GraphQL's existing error representation"}),"\n",(0,i.jsx)(n.li,{children:"Is simple to implement and understand"}),"\n",(0,i.jsx)(n.li,{children:"Leaves room for future extensions if more sophisticated error handling patterns prove necessary"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-conclusion",children:"\ud83d\udcdd Conclusion"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"@disableErrorPropagation"})," directive provides a simple but powerful way for clients to control error propagation behavior. While it doesn't solve all error handling challenges, it represents an important step toward uncoupling nullability and errors in GraphQL. This allows for more precise schema design while maintaining backwards compatibility for existing clients."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>o});var i=r(7294);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);
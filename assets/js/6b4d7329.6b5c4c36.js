"use strict";(self.webpackChunk_localrepo_benjie_dev=self.webpackChunk_localrepo_benjie_dev||[]).push([[7537],{7455:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var r=n(5893),l=n(1151);const i={identifier:"1059",title:"Introduce Strict and Legacy All Variable Usages Are Allowed",stage:"1",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/1059",events:[{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",date:new Date("2023-12-07T00:00:00.000Z"),actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",date:"2023-12",actor:null},{type:"prCreated",date:new Date("2023-11-10T12:03:23.000Z"),href:"https://github.com/graphql/graphql-spec/pull/1059",actor:"benjie"},{type:"commitsPushed",date:new Date("2023-11-10T00:00:00.000Z"),href:"https://github.com/graphql/graphql-spec/commit/800815de8d44511c54946bf4cb6840a97e9b5c15",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/800815de8d44511c54946bf4cb6840a97e9b5c15",headline:"Introduce Strict and Legacy AllVariableUsagesAreAllowed",ghUser:"benjie",authorName:"Benjie Gillam"}]}],related:"wg1337",shortname:"Introduce Strict and Legacy All Variable Usages Are Allowed",image:"/img/rfc_tracker.png"},a=void 0,s={id:"1059",title:"Introduce Strict and Legacy All Variable Usages Are Allowed",description:"At a glance",source:"@site/rfcs/1059.md",sourceDirName:".",slug:"/1059",permalink:"/rfcs/1059",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{identifier:"1059",title:"Introduce Strict and Legacy All Variable Usages Are Allowed",stage:"1",champion:"benjie",prUrl:"https://github.com/graphql/graphql-spec/pull/1059",events:[{type:"wgAgenda",href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",date:"2023-12-07T00:00:00.000Z",actor:null},{type:"wgNotes",href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",date:"2023-12",actor:null},{type:"prCreated",date:"2023-11-10T12:03:23.000Z",href:"https://github.com/graphql/graphql-spec/pull/1059",actor:"benjie"},{type:"commitsPushed",date:"2023-11-10T00:00:00.000Z",href:"https://github.com/graphql/graphql-spec/commit/800815de8d44511c54946bf4cb6840a97e9b5c15",actor:"benjie",commits:[{href:"https://github.com/graphql/graphql-spec/commit/800815de8d44511c54946bf4cb6840a97e9b5c15",headline:"Introduce Strict and Legacy AllVariableUsagesAreAllowed",ghUser:"benjie",authorName:"Benjie Gillam"}]}],related:"wg1337",shortname:"Introduce Strict and Legacy All Variable Usages Are Allowed",image:"/img/rfc_tracker.png"},sidebar:"rfcsSidebar",previous:{title:"List coercion algorithm",permalink:"/rfcs/1058"},next:{title:"allow unions to include interfaces and unions",permalink:"/rfcs/950"}},o={},c=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Timeline",id:"timeline",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Identifier"}),": #1059"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Stage"}),": ",(0,r.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-1-proposal",children:"RFC1: Proposal"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Champion"}),": ",(0,r.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PR"}),": ",(0,r.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/pull/1059",children:"Introduce Strict and Legacy All Variable Usages Are Allowed"})]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"timeline",children:"Timeline"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsxs)(t.strong,{children:["Added to ",(0,r.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/agendas/2023/12-Dec/07-wg-primary.md",children:"2023-12-07 WG agenda"})]})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsxs)(t.strong,{children:["Mentioned in ",(0,r.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/blob/main/notes/2023/2023-12.md",children:"2023-12 WG notes"})]})}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsxs)(t.strong,{children:[(0,r.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/pull/1059",children:"Spec PR"})," created"]})," on 2023-11-10 by benjie"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Commit pushed"}),": ",(0,r.jsx)(t.a,{href:"https://github.com/graphql/graphql-spec/commit/800815de8d44511c54946bf4cb6840a97e9b5c15",children:"Introduce Strict and Legacy AllVariableUsagesAreAllowed"})," on 2023-11-10 by ",(0,r.jsx)(t.a,{href:"https://github.com/benjie",children:"@benjie"})]}),"\n"]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"For the following schema:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-graphql",children:"type Query {\n  sum(numbers:[Int!]!): Int\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"The following query is currently valid:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-graphql",children:"query Q ($number: Int = 3) {\n  sum(numbers: [1, $number, 3])\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["This query will accept the variables ",(0,r.jsx)(t.code,{children:'{"number": null}'})," and result in a runtime ",(0,r.jsx)(t.em,{children:"field error"})," when it turns out that ",(0,r.jsx)(t.code,{children:"null"})," cannot be used in this non-nullable list value position. This was discussed in depth in the December 2022 Secondary EU WG meeting, resulting in this action item ",(0,r.jsx)(t.a,{href:"https://github.com/graphql/graphql-wg/issues/1337",children:"https://github.com/graphql/graphql-wg/issues/1337"}),". Timestamped link to the relevant part of the discussion: ",(0,r.jsx)(t.a,{href:"https://youtu.be/nkPn-F_UBJo?list=PLP1igyLx8foH30_sDnEZnxV_8pYW3SDtb&t=2702",children:"https://youtu.be/nkPn-F_UBJo?list=PLP1igyLx8foH30_sDnEZnxV_8pYW3SDtb&t=2702"})]}),"\n",(0,r.jsx)(t.p,{children:"This PR implements the agreed solution: it introduces a stricter version of the All Variable Usages Are Allowed algorithm which forbids a nullable variable from being used in a non-nullable position; and to support existing documents a legacy version of the old algorithm is maintained (basically a copy/paste)."}),"\n",(0,r.jsx)(t.p,{children:"Under the new strict algorithm, the previous query becomes invalid and you'd need to make the variable type non-nullable:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-graphql",children:"query Q ($number: Int! = 3) {\n  sum(numbers: [1, $number, 3])\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["This still allows the variable ",(0,r.jsx)(t.code,{children:"$number"})," to be omitted, but it does not allow it to be explicitly ",(0,r.jsx)(t.code,{children:"null"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"IMPORTANT NOTE"}),": this new algorithm does not allow an argument/input object field's default value to be used if a variable is used as the value for that argument/input object field. A workaround is to copy the argument/input object field's default value to the variable definition, but this will mean that changes to the argument/input object field's default value will not be reflected by existing queries. I think this is acceptable, since there's no way to leverage the default value of an argument when passing a literal to it either - I'm in favour of literal/variable equivalence where possible, and I think that the benefits of turning this runtime error into a validation error outweigh the costs."]}),"\n",(0,r.jsx)(t.p,{children:"cc @leebyron @mjmahone @IvanGoncharov as they were participants in the discussion above and contributed to this decision."}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,l.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>s,a:()=>a});var r=n(7294);const l={},i=r.createContext(l);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);
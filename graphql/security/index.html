<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-graphql/security" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">GraphQL Security | benjie.dev</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://benjie.dev/img/avatar.jpg"><meta data-rh="true" name="twitter:image" content="https://benjie.dev/img/avatar.jpg"><meta data-rh="true" property="og:url" content="https://benjie.dev/graphql/security"><meta data-rh="true" property="og:locale" content="en_GB"><meta data-rh="true" name="docusaurus_locale" content="en-GB"><meta data-rh="true" name="docsearch:language" content="en-GB"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="twitter:title" content="GraphQL Security | benjie.dev"><meta data-rh="true" property="og:title" content="GraphQL Security | benjie.dev"><meta data-rh="true" name="description" content="Techniques to protect your GraphQL API."><meta data-rh="true" property="og:description" content="Techniques to protect your GraphQL API."><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://benjie.dev/graphql/security"><link data-rh="true" rel="alternate" href="https://benjie.dev/graphql/security" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://benjie.dev/graphql/security" hreflang="x-default"><script src="https://assets.calendly.com/assets/external/widget.js"></script><link rel="stylesheet" href="/assets/css/styles.c47278a5.css">
<script src="/assets/js/runtime~main.16969ceb.js" defer="defer"></script>
<script src="/assets/js/main.1ea72951.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/avatar.jpg" alt="benjie" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/avatar.jpg" alt="benjie" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">benjie.dev</b></a><a class="navbar__item navbar__link" href="/rfcs/">RFCs</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/book">ðŸ“ž Book a call</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">about:benjie</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/graphql/">GraphQL</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/graphql/security">GraphQL Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphql/trusted-documents">Trusted Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphql/static-documents">Static Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphql/naming">Naming Conventions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/graphql/nullability/">Nullability</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/graphql/nullability/status">WG Status</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphql/nested-mutations">Nested Mutations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphql/traversal">Graph Traversal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphql/normalized">Normalized Stores</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphql/ancestors">Referencing Ancestors</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/talks/">Talks</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/talks/techniques-to-protect">Techniques to Protect Your GraphQL API</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/linux/">Linux</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/linux/bluetooth-dual-boot">Dual boot bluetooth pairing</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/graphql/"><span itemprop="name">GraphQL</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">GraphQL Security</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Protecting your GraphQL API</h1>
<p>The security practices you invoke for protecting your GraphQL API will differ
depending on how you expose it and how you intend it to be consumed. GraphQL is
not tied to any particular transport, in fact it does not need a transport at
all â€” it&#x27;s fairly common to consume GraphQL directly via a local function
call within your application&#x27;s memory space. That said, the majority of GraphQL
schemas are exposed over a network, most commonly over HTTP as specified by the
<a href="https://graphql.github.io/graphql-over-http/draft/" target="_blank" rel="noopener noreferrer">GraphQL-over-HTTP specification</a>.</p>
<p>This page aims to outline some of the techniques and concerns you should
consider when protecting your GraphQL-over-HTTP API from malicious traffic. It
is not exhaustive, and it does not cover the standard best practices that would
apply to any HTTP API whether it&#x27;s GraphQL, REST, gRPC, SOAP, or anything else
â€” instead it focusses only on GraphQL-specific topics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rejecting-malicious-documents">Rejecting malicious documents<a href="#rejecting-malicious-documents" class="hash-link" aria-label="Direct link to Rejecting malicious documents" title="Direct link to Rejecting malicious documents">â€‹</a></h2>
<aside class="pullquote_fEhA"><blockquote><p><strong>Protecting</strong> your servers <strong>against malicious queries</strong> is one of the key
concerns of GraphQL security</p></blockquote></aside>
<p>Though GraphQL&#x27;s query language acts as a well defined security boundary between
the client and your business logic, the language itself can enable asymmetric
attacks â€” without much effort, malicious actors can issue requests for the
server to perform large amounts of work. This can be leveraged to perform denial
of service attacks.</p>
<p>Therefore, protecting your servers against malicious queries is one of the key
concerns of GraphQL security.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trusted-documents">Trusted documents<a href="#trusted-documents" class="hash-link" aria-label="Direct link to Trusted documents" title="Direct link to Trusted documents">â€‹</a></h3>
<p>The simplest way to protect against malicious documents is to only allow
pre-approved documents that you are sure are not malicious. This technique is
only suitable where you can know the required documents ahead of time, but this
is fortunately the case for the vast majority of APIs since they are only
designed to power the organization&#x27;s own applications (web apps, mobile apps,
desktop apps and so on). Public APIs intended to receive arbitrary third party
queries, for example the
<a href="https://docs.github.com/en/graphql" target="_blank" rel="noopener noreferrer">GitHub GraphQL API</a>, can sadly not use this
technique for all requests â€” though it can still be used for first-party
applications, third-party requests will require additional checks.</p>
<aside class="pullquote_fEhA"><blockquote><p><strong>If you can use trusted documents, you should!</strong></p></blockquote></aside>
<p>If you can <a href="/graphql/trusted-documents"><strong>use trusted documents</strong></a>, you should!
They are a powerful technique that protects your GraphQL API against a certain
class of known and unknown threats. We&#x27;ve written about this highly recommended
security technique in detail in the
<a href="/graphql/trusted-documents">GraphQL Trusted Documents page</a> page.</p>
<p><a href="/graphql/trusted-documents"><img loading="lazy" alt="Trusted Documents: if you can, you should!" src="/assets/images/if_you_can_you_should-b5538124d3ab9fb4af1cd209136c91c4.png" width="1024" height="1024" class="img_ev3q"></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="custom-validation-rules">Custom validation rules<a href="#custom-validation-rules" class="hash-link" aria-label="Direct link to Custom validation rules" title="Direct link to Custom validation rules">â€‹</a></h3>
<p>The GraphQL specification details standard validation rules, but most servers
will allow you to add your own custom validation rules above and beyond these.</p>
<p>Normally validation applies only to documents and does not factor in variables,
so we&#x27;ll concentrate on these document-only validation rules for now. In the
&quot;malicious requests&quot; section below we&#x27;ll talk about validation rules that also
factor in variable values.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="depth-limit">Depth limit<a href="#depth-limit" class="hash-link" aria-label="Direct link to Depth limit" title="Direct link to Depth limit">â€‹</a></h4>
<p>A depth limit is a basic protection that throws out documents that attempt to
query &quot;too deep&quot; into your schema. GraphQL execution operates on a
layer-by-layer basis, and this rule limits the number of layers involved.</p>
<p>What limits you apply are dependent on your schema and your clients needs but
it&#x27;s common to see legitimate GraphQL queries that are 12 or more levels deep -
for example the standard GraphQL introspection query used by GraphiQL is 14
levels deep. It&#x27;s generally best to start with a low limit and increase it if
you need to, and to use a separate limit for introspection:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">maxDepth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">maxIntrospectionDepth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s not uncommon to need to increase <code>maxDepth</code> into the twenties, so simple
depth limiting is a fairly limited protection in itself but at least rules out
the very worst offenders.</p>
<aside class="pullquote_fEhA"><blockquote><p>Simple <strong>depth limiting</strong> is a fairly <strong>limited protection</strong></p></blockquote></aside>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="list-depth-limit">List depth limit<a href="#list-depth-limit" class="hash-link" aria-label="Direct link to List depth limit" title="Direct link to List depth limit">â€‹</a></h4>
<p>Though it&#x27;s fairly common to have legitimate GraphQL queries that are quite
deep, it&#x27;s rare to see clients legitimately query lists in GraphQL more than 2
levels deep because past that pagination becomes a real struggle! Lists are also
much more dangerous since they can cause an exponential growth in the complexity
of the request - rather than just adding another layer as would be the case with
an object field, they add a layer that must be executed N times, once for each
returned item in the list.</p>
<aside class="pullquote_fEhA"><blockquote><p><strong>list depth limiting</strong> is a <strong>vital mitigation</strong> against <strong>exponential</strong>
workloads from bad actors exploiting <strong>cycles</strong> in your graph</p></blockquote></aside>
<p>Consider a GraphQL API representing a film database; and imagine that each film
within it has an average cast size of 100, each actor has on average 2 children,
each of these children act in on average 20 films (it&#x27;s all about who you
know!), and each film has on average 100 crew. A simple query like this that is
only 5 levels deep could already be requesting in the order of 40 million
records (many of which will be repeated records), with minimal effort from the
client. Even if the server can fetch this highly-redundant data efficiently,
serializing it to send over the wire is still a significant amount of effort
(and memory usage)!</p>
<div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-graphql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property-query">allFilms</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">first</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 100 films</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token object">cast</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 100 * 100 cast</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token object">children</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 100 * 100 * 2 children</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token object">films</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># 100 * 100 * 2 * 20 films</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token object">crew</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 100 * 100 * 2 * 20 * 100 crew = 40,000,000 nodes!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Therefore list depth limiting is a vital mitigation, preventing bad actors from
exploiting cycles in your graph to have your server perform exponentially
growing workloads. Prevent all documents from querying lists any deeper than you
specifically need; start with a low limit on list nesting, and increase it if
you need to.</p>
<p>Introspection has slightly different needs here (we want to exhaustively know
everything about the schema, which involves querying
<code>__schema&gt;types&gt;fields&gt;args</code> - three levels of lists), but because it&#x27;s entirely
synchronous we can use a larger limit:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">maxListDepth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">maxIntrospectionListDepth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="self-referential-limits">Self-referential limits<a href="#self-referential-limits" class="hash-link" aria-label="Direct link to Self-referential limits" title="Direct link to Self-referential limits">â€‹</a></h4>
<aside class="pullquote_fEhA"><blockquote><p>attackers can abuse the <strong>cycles</strong> in your graph</p></blockquote></aside>
<p>GraphQL schemas tend to contain loads of cycles, and attackers can abuse the
cycles in your graph to request the server perform excessively large amounts of
work. It&#x27;s best to start with a base line of not allowing the same field to be
requested inside of its own selection sets (directly or transitively):</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">maxSelfReferentialDepth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">maxIntrospectionSelfReferentialDepth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, it&#x27;s vital to note that there will be fields where self-references are
reasonable. For example in the graphql.js introspection query
<a href="https://github.com/graphql/graphql-js/blob/9a91e338101b94fb1cc5669dd00e1ba15e0f21b3/src/utilities/getIntrospectionQuery.ts#L140-L179" target="_blank" rel="noopener noreferrer"><code>ofType</code> is queried 9 levels deep</a>.
Other examples of legitimate self-referential queries include &quot;friends of
friends&quot; in a social networking API, or following the maternal or paternal line
backwards in a genealogy API
(<code>person { mother { mother { mother { mother { name } } } } }</code>). Thus it&#x27;s
important when creating self-referential limits to ensure that these exceptions
can be specifically allowed:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">&quot;__Type.ofType&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;User.friends&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;Person.mother&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;Person.father&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For introspection overrides, I recommend the following:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">&quot;__Type.ofType&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;__Type.fields&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;__Type.inputFields&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;__Type.interfaces&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;__Type.possibleTypes&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;__Field.args&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;__Field.type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alias-limits">Alias limits<a href="#alias-limits" class="hash-link" aria-label="Direct link to Alias limits" title="Direct link to Alias limits">â€‹</a></h3>
<p>Sometimes its reasonable for a client to execute a field more than once, with
different parameters - for example to generate an avatar in two different sizes.
And generally, because GraphQL is a client-focussed language, we want to allow
clients to rename fields for their own convenience. For these reasons, GraphQL
allows aliasing of fields.</p>
<p>However, this useful feature introduces another attack vector; for example an
attacker might use aliases to request a server generate an avatar in every
possible size in order to tie up the servers resources resulting in a denial of
service.</p>
<p>Limiting the number of aliases a particular field can have is one solution;
though you will need overrides to allow for the fields where multiple aliases
would be reasonable.</p>
<p>It&#x27;s important to note that every alias a field has causes its resolver and the
resolvers on all descendents of that field to be called, potentially multiplying
up the server&#x27;s workload. Usage of techniques such as DataLoader somewhat
mitigate this, but it may be best to not allow multiple aliases by default, and
then liberally add exceptions where sensible.</p>
<p>Some people choose to disable aliases entirely, but I would not recommend this:
GraphQL is a client-focussed technology and clients often want to rename things
to make them easier to work with. Some GraphQL clients even rely on the ability
to alias fields, so disabling aliases would also prevent these clients from
operating.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="more-resources">More resources<a href="#more-resources" class="hash-link" aria-label="Direct link to More resources" title="Direct link to More resources">â€‹</a></h3>
<p>The above options relate to <a href="https://npmjs.com/package/gqlcheck" target="_blank" rel="noopener noreferrer">gqlcheck</a> which
can quickly analyze all your GraphQL documents in parallel with efficient AST
traversal, and is pluggable so that additional checks can be easily added. This
project started out with the intent of analysing static documents (e.g. during
your CI process for checking your trusted documents are relatively safe) but
we&#x27;ll likely add a way of leveraging its rules for runtime validation at some
point - if this interests you, please file an issue!</p>
<p>Another system I recommend that you run in CI to help your developers write safe
queries is <a href="https://the-guild.dev/graphql/eslint/docs" target="_blank" rel="noopener noreferrer">graphql-eslint</a>; and
whilst we&#x27;re talking about projects from The Guild you should also check out
Yoga&#x27;s excellent
<a href="https://the-guild.dev/graphql/envelop/v3/guides/securing-your-graphql-api" target="_blank" rel="noopener noreferrer">Securing your GraphQL API</a>
article.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rejecting-malicious-requests">Rejecting malicious requests<a href="#rejecting-malicious-requests" class="hash-link" aria-label="Direct link to Rejecting malicious requests" title="Direct link to Rejecting malicious requests">â€‹</a></h2>
<p>A <em>GraphQL request</em> is composed of the <em>document</em> we discussed above, along with
any runtime values for <em>variables</em> and an indication of which <em>operation name</em>
to execute if the document defines more than one operation.</p>
<p>Whether or not you use <a href="/graphql/trusted-documents">Trusted Documents</a>,
attackers can attempt to supply malicious variable values as an attack vector,
so it&#x27;s important to consider how these may be abused.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pagination-limits">Pagination limits<a href="#pagination-limits" class="hash-link" aria-label="Direct link to Pagination limits" title="Direct link to Pagination limits">â€‹</a></h3>
<aside class="pullquote_fEhA"><blockquote><p><strong>every</strong> collection resolver should enforce <strong>pagination limits</strong></p></blockquote></aside>
<p>I&#x27;m sure you wouldn&#x27;t want someone to request 10 billion records from one of
your collections â€” every collection resolver should <strong>enforce pagination
limits</strong> (either directly, or in the business logic it calls) to prevent
attackers having an easy time. What value to limit to depends on the complexity
of the field in question including the shape of the data it returns, but common
limits include 10, 25, 100 and 500. Beware that large limits multiply by the
number of levels of lists you allow to query, so with a <code>maxListDepth</code> of <code>3</code>, a
limit of <code>500</code> for each list could still yield <code>500^3 = 125,000,000</code> records!
Default to using a low pagination limit (e.g. 25) and only increase it when
necessary.</p>
<aside class="pullquote_fEhA"><blockquote><p>variable-aware <strong>validation rules</strong> [...] can throw out requests that exceed
your limits before they even start to execute</p></blockquote></aside>
<p>Limits like these in resolvers require the operation to actually execute for the
limit to take effect; by leveraging <strong>variable-aware validation rules</strong> we can
enforce consistent pagination limits for every request and throw out requests
that exceed your limits before they even start to execute. We can even calculate
the maximum number of nodes that would be returned by a request and reject it if
it&#x27;s too high (e.g.
<code>allFilms(first: 25) { cast(first: 10) { children(first: 10) { ...</code> may be
allowed since it would return at most 2500 nodes; whereas
<code>allFilms(first: 500) { cast(first: 500) { children(first: 500) { ...</code> may be
forbidden since 125 million is likely unreasonable).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-cost-analysis">Query cost analysis<a href="#query-cost-analysis" class="hash-link" aria-label="Direct link to Query cost analysis" title="Direct link to Query cost analysis">â€‹</a></h3>
<p>Trusted documents prevent attackers from sending our servers expensive queries,
but if you can&#x27;t use them
(<a href="/graphql/trusted-documents">if you can, you should!</a>) then query
cost/complexity analysis is another technique to add to your arsenal. By applies
heuristics during AST traversal, a maximal cost of a request can be estimated,
and request that exceed a given cost limit can be rejected prior to execution.
It&#x27;s even possible to factor this calculated cost into your rate limits, so a
user may only perform a small number of large complex queries, but could perform
a larger number of simpler smaller queries.</p>
<p>Figuring out the cost of a document is itself an expensive process that can be
attacked, so if you use this technique think about how the technique itself can
be abused.</p>
<p>IBM have written a well-researched
<a href="https://ibm.github.io/graphql-specs/" target="_blank" rel="noopener noreferrer">GraphQL Cost Directives Specification</a>
you can follow, and there are a number of existing solutions out there that are
just a search away.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="beware-graphql-bombs">Beware: GraphQL bombs<a href="#beware-graphql-bombs" class="hash-link" aria-label="Direct link to Beware: GraphQL bombs" title="Direct link to Beware: GraphQL bombs">â€‹</a></h3>
<p>If your GraphQL API accepts file uploads (I&#x27;d strongly advise against that,
GraphQL is not really designed for file uploads!) then be sure to protect
yourself from
<a href="https://escape.tech/blog/forging-graphql-bombs-the-2022-version-of-zip-bombs/" target="_blank" rel="noopener noreferrer">GraphQL bombs</a> -
where a moderately sized uploaded file can be referenced many times within a
document to invoke large memory usage on the server, potentially leading to
denial of service.</p>
<p>To protect against this, either don&#x27;t allow <code>multipart/form-data</code> requests to
your GraphQL API and use a different technology for file uploads, or:</p>
<ol>
<li>Limit the size of file uploads</li>
<li>When designing your schema, only allow file uploads to be referenced in root
positions (never inside of lists!)</li>
<li>Prevent the same file upload variable from being referenced multiple times in
the same document (via a custom validation rule)</li>
<li>Don&#x27;t allow any kind of GraphQL request or variable batching to be used with
file uploads</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multipartform-data-and-applicationx-www-form-urlencoded"><code>multipart/form-data</code> and <code>application/x-www-form-urlencoded</code><a href="#multipartform-data-and-applicationx-www-form-urlencoded" class="hash-link" aria-label="Direct link to multipartform-data-and-applicationx-www-form-urlencoded" title="Direct link to multipartform-data-and-applicationx-www-form-urlencoded">â€‹</a></h3>
<p>When using <code>multipart/form-data</code>, <code>application/x-www-form-urlencoded</code>, and other
&quot;simple&quot; content-types, browsers bypass CORS preflight requests. This allows
attackers to attempt CSRF requests - if one of your logged-in users visits a
malicious website, that site can make a request to your API using their cookies,
with potentially disastrous results (privilege escalation, account deletion,
etc).</p>
<p>To protect against this, simply do not allow these &quot;simple&quot; content types and
stick to the standard <code>application/json</code> as detailed in the
<a href="https://graphql.github.io/graphql-over-http/draft/" target="_blank" rel="noopener noreferrer">GraphQL-over-HTTP specification</a>.
Alternatively, ensure that requests contain a custom header (e.g.
<code>GraphQL-Require-Preflight</code> or <code>X-CSRF-Token</code>), which forces browsers to perform
preflight requests allowing you to prevent this style of attack.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="protecting-validation">Protecting validation<a href="#protecting-validation" class="hash-link" aria-label="Direct link to Protecting validation" title="Direct link to Protecting validation">â€‹</a></h2>
<p>A lot of our solutions above related to validation; but validation itself is a
potential attack vector.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="limit-validation-errors">Limit validation errors<a href="#limit-validation-errors" class="hash-link" aria-label="Direct link to Limit validation errors" title="Direct link to Limit validation errors">â€‹</a></h3>
<p>Consider the query <code>{a a a a a a a a â€¦ a a a a a a a a}</code> with as many <code>a</code> as
your server allows. This might seem harmless enough, but assuming that your
schema does not have a <code>Query.a</code> field, each <code>a</code> here will generate a separate
validation error, requiring the server to send a much much larger response body
than the query body would suggest:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Cannot query field \&quot;a\&quot; on type \&quot;Root\&quot;.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;locations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;line&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;column&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Cannot query field \&quot;a\&quot; on type \&quot;Root\&quot;.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;locations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;line&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;column&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Cannot query field \&quot;a\&quot; on type \&quot;Root\&quot;.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;locations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;line&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;column&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        â€¦</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A 100KB query containing ~50k <code>a</code> characters producing errors like the above
would have the server send a 11MB payload - over 100x the size of the input.</p>
<p>Even worse, many GraphQL implementations have a &quot;did you mean&quot; helper on
validation errors to aid developers by hinting at the field names they may have
intended, but this search for matching field names uses additional compute and
can make the payload even larger.</p>
<p>It&#x27;s best to limit the number of validation errors that can be produced in
production, and if this limit is exceeded then abort validation and return a
reasonable error:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Too many validation errors, error limit reached. Validation aborted.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="size-and-token-limits">Size and token limits<a href="#size-and-token-limits" class="hash-link" aria-label="Direct link to Size and token limits" title="Direct link to Size and token limits">â€‹</a></h3>
<p>Even getting as far as counting errors in validation can consume a lot of
resources. Before the GraphQL server even starts the validation process it needs
to parse the document, and we can apply a limit to the number of tokens that the
document can contain and abort parsing if this limit is exceeded. It&#x27;s up to you
to determine a sensible number of tokens for your applications, but consider
starting around 1000 and raising the limit if legitimate queries are bumping up
against it.</p>
<p>Parsing itself involves some amount of effort - another protection we should
consider is limiting the size of GraphQL documents that we will even attempt to
parse. This would be the limit of the GraphQL document size in bytes, a
reasonable starting point might be 10kB, and then increase it as need be. A
slightly larger limit should be applied to the request body (which would include
any variables) - assuming you&#x27;re not handling file uploads or large bodies of
text, 100kB can often be suitable for simple CRUD APIs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation-timeout">Validation timeout<a href="#validation-timeout" class="hash-link" aria-label="Direct link to Validation timeout" title="Direct link to Validation timeout">â€‹</a></h3>
<p>Some parts of validation are more expensive than others, for example field
collection can involve a lot of AST traversal, leading to a lot of CPU usage. If
possible, it may make sense to apply a timeout to validation itself and reject
requests that take too long (and consider rate limiting that user quite
heavily!). However, &quot;noisy neighbor&quot; issues may mean that these kinds of very
low time limits (milliseconds) may be exceeded sporadically so some amount of
leeway is reasonable.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="protecting-runtime">Protecting runtime<a href="#protecting-runtime" class="hash-link" aria-label="Direct link to Protecting runtime" title="Direct link to Protecting runtime">â€‹</a></h2>
<p>We&#x27;ve done what we can above to avoid malicious requests from being executed in
the first place; but it&#x27;s likely some will still fly in under the radar,
purporting to be legitimate requests. Here are some things to consider to
protect the runtime of your GraphQL API.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="timeouts">Timeouts<a href="#timeouts" class="hash-link" aria-label="Direct link to Timeouts" title="Direct link to Timeouts">â€‹</a></h3>
<p>One of the most common ways of protecting an API of any kind is with a timeout;
if execution passes a certain threshold (e.g. 10 seconds) then it should be
aborted and an error returned. (We should also rate limit this user to prevent
this slow query from impacting the stability of our API.) However, keep in mind
that these limits may need to be extended for incremental delivery requests
(those involving <code>@stream</code> and/or <code>@defer</code> directives) and maybe suspended
entirely for subscription requests (whether over websockets, server-sent events,
or otherwise).</p>
<p>In addition to per-request timeouts, the underlying business logic should
perform its own timeouts to avoid resources being tied up for too long, and you
should also consider
<a href="https://martinfowler.com/bliki/CircuitBreaker.html?ref=wellarchitected" target="_blank" rel="noopener noreferrer">the circuit-breaker pattern</a>
in your business logic so that if a part of your infrastructure fails, the
related parts of GraphQL requests can exit early whilst allowing the rest of the
request to still return useful data.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cancellation-token">Cancellation token<a href="#cancellation-token" class="hash-link" aria-label="Direct link to Cancellation token" title="Direct link to Cancellation token">â€‹</a></h3>
<p>Telling the user that their request took too long so you&#x27;re returning an error
is not enough, we need to actually stop any asynchronous work that&#x27;s taking
place. For some languages this is part-and-parcel of a timeout, but for others
asynchronous work must be manually handled by passing around a &quot;cancellation
token&quot; of some kind - each asynchronous operation should subscribe to this
token, and should abort as soon as it triggers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rate-limiting">Rate limiting<a href="#rate-limiting" class="hash-link" aria-label="Direct link to Rate limiting" title="Direct link to Rate limiting">â€‹</a></h3>
<aside class="pullquote_fEhA"><blockquote><p>it&#x27;s vital to <strong>rate limit</strong> within the <strong>business-logic</strong></p></blockquote></aside>
<p>HTTP-level rate limiting is a common protection for any API type, but in GraphQL
there are many ways to circumvent this. If the GraphQL service supports it, an
attacker could use
<a href="https://github.com/graphql/graphql-over-http/issues/5" target="_blank" rel="noopener noreferrer">operation batching</a>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;query&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;mutation{login(username:\&quot;admin\&quot;,pin:\&quot;0000\&quot;)}&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;query&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;mutation{login(username:\&quot;admin\&quot;,pin:\&quot;0001\&quot;)}&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;query&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;mutation{login(username:\&quot;admin\&quot;,pin:\&quot;0002\&quot;)}&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â€¦</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>or
<a href="https://github.com/graphql/composite-schemas-spec/issues/25" target="_blank" rel="noopener noreferrer">variable batching</a>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;query&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;mutation($p:String!){login(username:\&quot;admin\&quot;,pin:$p)}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;variables&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;p&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;0000&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;p&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;0001&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;p&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;0002&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  â€¦</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>They could also use aliases within the GraphQL document:</p>
<div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-graphql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">mutation</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$u</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">String</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">m0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token property-query">login</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token variable" style="color:#36acaa">$u</span><span class="token punctuation" style="color:#393A34">,</span><span class="token attr-name" style="color:#00a4db">pin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;0000&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">m1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token property-query">login</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token variable" style="color:#36acaa">$u</span><span class="token punctuation" style="color:#393A34">,</span><span class="token attr-name" style="color:#00a4db">pin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;0001&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">m2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token property-query">login</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token variable" style="color:#36acaa">$u</span><span class="token punctuation" style="color:#393A34">,</span><span class="token attr-name" style="color:#00a4db">pin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;0002&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  â€¦</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Combining these techniques could allow an attacker to perform an operation
orders of magnitude more often than the HTTP-level rate limit would imply.</p>
<p>Therefore it&#x27;s vital to ensure that vulnerable fields are rate limited at the
resolver or business-logic level, in addition to any HTTP-level rate limits.
Further, HTTP-level rate limits should also factor in the size of any batches
contained therein.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-errors">Runtime errors<a href="#runtime-errors" class="hash-link" aria-label="Direct link to Runtime errors" title="Direct link to Runtime errors">â€‹</a></h3>
<p>We&#x27;ve discussed validation errors above; runtime errors have their own concerns.
GraphQL is designed to support partial success - even in the face of errors, we
want to render what we can for the user - but unexpected errors can often
contain privileged information. This information is useful for developers, but
also very useful to attackers. We should therefore prevent unsafe errors being
surfaced to end users in production, instead masking the error and writing the
details to a server log that only trusted parties can see. Some errors (for
example, data validation errors) may be safe to send through, but all other
errors should be masked by default.</p>
<p>Read more about error masking in
<a href="https://the-guild.dev/graphql/yoga-server/docs/features/error-masking" target="_blank" rel="noopener noreferrer">The Guild&#x27;s Yoga documentation</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="general-resources">General resources<a href="#general-resources" class="hash-link" aria-label="Direct link to General resources" title="Direct link to General resources">â€‹</a></h2>
<p>OWASP security cheatsheet:
<a href="https://cheatsheetseries.owasp.org/cheatsheets/GraphQL_Cheat_Sheet.html" target="_blank" rel="noopener noreferrer">https://cheatsheetseries.owasp.org/cheatsheets/GraphQL_Cheat_Sheet.html</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/graphql/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">GraphQL</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/graphql/trusted-documents"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Trusted Documents</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rejecting-malicious-documents" class="table-of-contents__link toc-highlight">Rejecting malicious documents</a><ul><li><a href="#trusted-documents" class="table-of-contents__link toc-highlight">Trusted documents</a></li><li><a href="#custom-validation-rules" class="table-of-contents__link toc-highlight">Custom validation rules</a></li><li><a href="#alias-limits" class="table-of-contents__link toc-highlight">Alias limits</a></li><li><a href="#more-resources" class="table-of-contents__link toc-highlight">More resources</a></li></ul></li><li><a href="#rejecting-malicious-requests" class="table-of-contents__link toc-highlight">Rejecting malicious requests</a><ul><li><a href="#pagination-limits" class="table-of-contents__link toc-highlight">Pagination limits</a></li><li><a href="#query-cost-analysis" class="table-of-contents__link toc-highlight">Query cost analysis</a></li><li><a href="#beware-graphql-bombs" class="table-of-contents__link toc-highlight">Beware: GraphQL bombs</a></li><li><a href="#multipartform-data-and-applicationx-www-form-urlencoded" class="table-of-contents__link toc-highlight"><code>multipart/form-data</code> and <code>application/x-www-form-urlencoded</code></a></li></ul></li><li><a href="#protecting-validation" class="table-of-contents__link toc-highlight">Protecting validation</a><ul><li><a href="#limit-validation-errors" class="table-of-contents__link toc-highlight">Limit validation errors</a></li><li><a href="#size-and-token-limits" class="table-of-contents__link toc-highlight">Size and token limits</a></li><li><a href="#validation-timeout" class="table-of-contents__link toc-highlight">Validation timeout</a></li></ul></li><li><a href="#protecting-runtime" class="table-of-contents__link toc-highlight">Protecting runtime</a><ul><li><a href="#timeouts" class="table-of-contents__link toc-highlight">Timeouts</a></li><li><a href="#cancellation-token" class="table-of-contents__link toc-highlight">Cancellation token</a></li><li><a href="#rate-limiting" class="table-of-contents__link toc-highlight">Rate limiting</a></li><li><a href="#runtime-errors" class="table-of-contents__link toc-highlight">Runtime errors</a></li></ul></li><li><a href="#general-resources" class="table-of-contents__link toc-highlight">General resources</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Benjie Gillam; all rights reserved. RFC pages pull content from public GitHub issues/PRs/files/etc; this content remains owned its various authors.</div></div></div></footer></div>
</body>
</html>
---
identifier: "776"
title: __typename is not valid at subscription root
stage: "3"
champion: benjie
prUrl: https://github.com/graphql/graphql-spec/pull/776
events:
  - type: wgAgenda
    href: https://github.com/graphql/graphql-wg/blob/main/agendas/2021/2021-05-13.md
    date: 2021-05-13
    actor: null
  - type: wgNotes
    href: https://github.com/graphql/graphql-wg/blob/main/notes/2021/2021-05-13.md
    date: 2021-05-13
    actor: null
  - type: commitsPushed
    date: 2021-04-15
    href: https://github.com/graphql/graphql-spec/commit/51d12920820bcc55d4f5d97df9eb820701eaafca
    actor: leebyron
    commits:
      - href: https://github.com/graphql/graphql-spec/commit/51d12920820bcc55d4f5d97df9eb820701eaafca
        headline: Update Section 5 -- Validation.md
        ghUser: leebyron
        authorName: Lee Byron
  - type: wgAgenda
    href: https://github.com/graphql/graphql-wg/blob/main/agendas/2021/2021-01-07.md
    date: 2021-01-07
    actor: null
  - type: wgNotes
    href: https://github.com/graphql/graphql-wg/blob/main/notes/2021/2021-01-07.md
    date: 2021-01-07
    actor: null
  - type: wgAgenda
    href: https://github.com/graphql/graphql-wg/blob/main/agendas/2020/2020-12-03.md
    date: 2020-12-03
    actor: null
  - type: wgNotes
    href: https://github.com/graphql/graphql-wg/blob/main/notes/2020/2020-12-03.md
    date: 2020-12-03
    actor: null
  - type: commitsPushed
    date: 2020-11-25
    href: https://github.com/graphql/graphql-spec/commit/967e3ed499e00591aeff26215124f18f6335a0bd
    actor: benjie
    commits:
      - href: https://github.com/graphql/graphql-spec/commit/967e3ed499e00591aeff26215124f18f6335a0bd
        headline: Update spec edits based on Lee's comments
        ghUser: benjie
        authorName: Benjie Gillam
      - href: https://github.com/graphql/graphql-spec/commit/7993225a7fe9ec2cdacc40d34e36339c62965850
        headline: Simplify
        ghUser: benjie
        authorName: Benjie Gillam
      - href: https://github.com/graphql/graphql-spec/commit/440b035161191fa51d297245c753b95a9174039e
        headline: Clarify
        ghUser: benjie
        authorName: Benjie Gillam
      - href: https://github.com/graphql/graphql-spec/commit/0cf4857a27bb0cf2774b12c27d8f0a67cec20d5a
        headline: Typo
        ghUser: benjie
        authorName: Benjie Gillam
  - type: wgAgenda
    href: https://github.com/graphql/graphql-wg/blob/main/agendas/2020/2020-10-01.md
    date: 2020-10-01
    actor: null
  - type: wgNotes
    href: https://github.com/graphql/graphql-wg/blob/main/notes/2020/2020-10-01.md
    date: 2020-10-01
    actor: null
  - type: prCreated
    date: 2020-09-14T14:46:10Z
    href: https://github.com/graphql/graphql-spec/pull/776
    actor: benjie
  - type: commitsPushed
    date: 2020-09-14
    href: https://github.com/graphql/graphql-spec/commit/1acee8a143ff41936fac4575bc0843d948046bd9
    actor: benjie
    commits:
      - href: https://github.com/graphql/graphql-spec/commit/1acee8a143ff41936fac4575bc0843d948046bd9
        headline: __typename is not valid at subscription root
        ghUser: benjie
        authorName: Benjie Gillam
related: "806"
shortname: __typename is not valid at subscription root
image: /img/rfc_tracker.png
---

## At a glance

- **Identifier**: #776
- **Stage**: [RFC3: Accepted](https://github.com/graphql/graphql-spec/blob/main/CONTRIBUTING.md#stage-3-accepted)
- **Champion**: [@benjie](https://github.com/benjie)
- **PR**: [__typename is not valid at subscription root](https://github.com/graphql/graphql-spec/pull/776)
- **Related**:
  - [#806](/rfcs/806 "__typename should be valid at subscription root / RFC0") (__typename should be valid at subscription root)

<!-- BEGIN_CUSTOM_TEXT -->



<!-- END_CUSTOM_TEXT -->

## Timeline

- **Added to [2021-05-13 WG agenda](https://github.com/graphql/graphql-wg/blob/main/agendas/2021/2021-05-13.md)**
- **Mentioned in [2021-05-13 WG notes](https://github.com/graphql/graphql-wg/blob/main/notes/2021/2021-05-13.md)**
- **Commit pushed**: [Update Section 5 -- Validation.md](https://github.com/graphql/graphql-spec/commit/51d12920820bcc55d4f5d97df9eb820701eaafca) on 2021-04-15 by [@leebyron](https://github.com/leebyron)
- **Added to [2021-01-07 WG agenda](https://github.com/graphql/graphql-wg/blob/main/agendas/2021/2021-01-07.md)**
- **Mentioned in [2021-01-07 WG notes](https://github.com/graphql/graphql-wg/blob/main/notes/2021/2021-01-07.md)**
- **Added to [2020-12-03 WG agenda](https://github.com/graphql/graphql-wg/blob/main/agendas/2020/2020-12-03.md)**
- **Mentioned in [2020-12-03 WG notes](https://github.com/graphql/graphql-wg/blob/main/notes/2020/2020-12-03.md)**
- **4 commits pushed** on 2020-11-25:
  - [Update spec edits based on Lee's comments](https://github.com/graphql/graphql-spec/commit/967e3ed499e00591aeff26215124f18f6335a0bd) by [@benjie](https://github.com/benjie)
  - [Simplify](https://github.com/graphql/graphql-spec/commit/7993225a7fe9ec2cdacc40d34e36339c62965850) by [@benjie](https://github.com/benjie)
  - [Clarify](https://github.com/graphql/graphql-spec/commit/440b035161191fa51d297245c753b95a9174039e) by [@benjie](https://github.com/benjie)
  - [Typo](https://github.com/graphql/graphql-spec/commit/0cf4857a27bb0cf2774b12c27d8f0a67cec20d5a) by [@benjie](https://github.com/benjie)
- **Added to [2020-10-01 WG agenda](https://github.com/graphql/graphql-wg/blob/main/agendas/2020/2020-10-01.md)**
- **Mentioned in [2020-10-01 WG notes](https://github.com/graphql/graphql-wg/blob/main/notes/2020/2020-10-01.md)**
- **[Spec PR](https://github.com/graphql/graphql-spec/pull/776) created** on 2020-09-14 by benjie
- **Commit pushed**: [__typename is not valid at subscription root](https://github.com/graphql/graphql-spec/commit/1acee8a143ff41936fac4575bc0843d948046bd9) on 2020-09-14 by [@benjie](https://github.com/benjie)

<!-- VERBATIM -->

---

I'm writing up some of the GraphQL "query ambiguity" work currently and noticed this issue in the spec. In the case of a subscription it seems that

```graphql
subscription {
  __typename
}
```

does not correctly get evaluated by the reference implementation during subscriptions (though you can query it with `graphql(...)` you can't access it via `subscribe(...)`). It doesn't really make sense to request `__typename` here since it's not ever going to change during the life of the schema, and subscriptions only support one root-level field, however I thought it was worth highlighting.

Reproduction with GraphQL-js (toggle which `doc` is commented to see a functioning subscription):

```js
const {
  GraphQLSchema,
  GraphQLObjectType,
  GraphQLInt,
  GraphQLFloat,
  parse,
  validate,
  subscribe,
} = require("graphql");

const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));

async function* everySecond() {
  for (let i = 0; i < 1000; i++) {
    yield i;
    await sleep(1000);
  }
}

const Query = new GraphQLObjectType({
  name: "Query",
  fields: {
    a: {
      type: GraphQLInt,
    },
  },
});

const Subscription = new GraphQLObjectType({
  name: "Subscription",
  fields: {
    ts: {
      type: GraphQLFloat,
      subscribe() {
        return everySecond();
      },
      resolve() {
        return Date.now();
      },
    },
  },
});

const schema = new GraphQLSchema({
  query: Query,
  subscription: Subscription,
});

async function main() {
  const doc = parse("subscription { __typename }");
  // const doc = parse("subscription { ts }");
  const errors = validate(schema, doc);
  if (errors && errors.length) {
    console.dir(errors);
    throw new Error("Errors occurred");
  }
  const result = await subscribe(schema, doc);
  console.dir(result);
  for await (const r of result) {
    console.dir(r);
  }
}

main().catch(e => {
  console.dir(e);
  process.exit(1);
});
```

Produces this error:

```
Error: Subscription field must return Async Iterable. Received: undefined
    at [...]/node_modules/graphql/subscription/subscribe.js:169:13
    at async main ([...]/test.js:57:18)
```
